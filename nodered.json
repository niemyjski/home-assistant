[
  {
    "id": "799d79fb.77ee38",
    "type": "tab",
    "label": "Master Bedroom",
    "disabled": false,
    "info": "Master Bedroom Automations"
  },
  {
    "id": "f67c7a34.9bcde",
    "type": "tab",
    "label": "Outside",
    "disabled": false,
    "info": "Automations that run outside\n"
  },
  {
    "id": "74ac8f9a.f9fa3",
    "type": "tab",
    "label": "Bathroom",
    "disabled": false,
    "info": "Controls Automations for the Bathroom Fans\n"
  },
  {
    "id": "3c07a459.ce903c",
    "type": "tab",
    "label": "Normalize Audio",
    "disabled": false,
    "info": "Normalize All Audio"
  },
  {
    "id": "7dca484b.45ae",
    "type": "tab",
    "label": "Subflows",
    "disabled": false,
    "info": "Reusable Subflows\n"
  },
  {
    "id": "5bb10f4e.f7bd8",
    "type": "tab",
    "label": "Laundry Room",
    "disabled": false,
    "info": ""
  },
  {
    "id": "cd444af.6970f38",
    "type": "tab",
    "label": "Closet Lights",
    "disabled": false,
    "info": ""
  },
  {
    "id": "edd021ae.2eeb9",
    "type": "tab",
    "label": "Motion Announcements",
    "disabled": false,
    "info": ""
  },
  {
    "id": "62d08d27.0c9114",
    "type": "tab",
    "label": "Family Room Lights",
    "disabled": false,
    "info": ""
  },
  {
    "id": "19c1cd7b.5d8c23",
    "type": "tab",
    "label": "Indoor Motion Lights",
    "disabled": false,
    "info": ""
  },
  {
    "id": "95c94ca0.1fe178",
    "type": "tab",
    "label": "Garage Doors",
    "disabled": false,
    "info": ""
  },
  {
    "id": "7a62a2d3.c0f4a4",
    "type": "subflow",
    "name": "Send Automation Speech Notification",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 60,
        "y": 100,
        "wires": [
          {
            "id": "89300b1.595bcf8"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1080,
        "y": 100,
        "wires": [
          {
            "id": "d44cc51a.be0668",
            "port": 0
          }
        ]
      }
    ],
    "status": {
      "x": 220,
      "y": 40,
      "wires": [
        {
          "id": "aef53056.742438",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "974adda.d2ea92",
    "type": "subflow",
    "name": "Set Volume Level",
    "info": "Set Volume Level",
    "category": "",
    "in": [
      {
        "x": 80,
        "y": 120,
        "wires": [
          {
            "id": "4c86fd47.0875e4"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 960,
        "y": 100,
        "wires": [
          {
            "id": "263d05a1.5b6672",
            "port": 0
          }
        ]
      }
    ],
    "status": {
      "x": 240,
      "y": 40,
      "wires": [
        {
          "id": "7a662cd5.162a24",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "76be143e.dbb0e4",
    "type": "subflow",
    "name": "Set Volume Level on All Media Devices",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 100,
        "y": 120,
        "wires": [
          {
            "id": "642c5f33.bd92a8"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 1080,
        "y": 120,
        "wires": [
          {
            "id": "15d5ddae.8f64c2",
            "port": 0
          }
        ]
      }
    ],
    "status": {
      "x": 1080,
      "y": 40,
      "wires": [
        {
          "id": "ba88f8d5.b5d648",
          "port": 0
        },
        {
          "id": "15d5ddae.8f64c2",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "af0c5464.36789",
    "type": "subflow",
    "name": "Turn On/Off Switch With Notification",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 100,
        "y": 180,
        "wires": [
          {
            "id": "7b55b409.713bdc"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 900,
        "y": 140,
        "wires": [
          {
            "id": "6aaaebf.24cf914",
            "port": 0
          },
          {
            "id": "474efe46.a70ec",
            "port": 0
          }
        ]
      }
    ],
    "status": {
      "x": 260,
      "y": 40,
      "wires": [
        {
          "id": "3625a6c3.3ec702",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "6325f627.09e548",
    "type": "subflow",
    "name": "Turn Fan On/Off With Notifications",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 80,
        "y": 200,
        "wires": [
          {
            "id": "aec6edc3.91bb2"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 900,
        "y": 120,
        "wires": [
          {
            "id": "758f438a.0ca1d4",
            "port": 0
          },
          {
            "id": "e1cd27f0.559aa",
            "port": 0
          }
        ]
      }
    ],
    "status": {
      "x": 240,
      "y": 40,
      "wires": [
        {
          "id": "165f45da.76cc6a",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "bafd53de.69711",
    "type": "subflow",
    "name": "Turn Light On/Off With Notifications",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 80,
        "y": 200,
        "wires": [
          {
            "id": "c6d3f892.6f2528"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 920,
        "y": 120,
        "wires": [
          {
            "id": "e94b9746.e44b8",
            "port": 0
          },
          {
            "id": "a90f2ebc.50003",
            "port": 0
          }
        ]
      }
    ],
    "status": {
      "x": 920,
      "y": 40,
      "wires": [
        {
          "id": "d8142bd2.f7a0f8",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "74bc2936.720808",
    "type": "subflow",
    "name": "Motion Switch",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 40,
        "y": 180,
        "wires": [
          {
            "id": "b5d20027.5ce2d"
          }
        ]
      }
    ],
    "out": [],
    "status": {
      "x": 900,
      "y": 40,
      "wires": [
        {
          "id": "54be94aa.6c0f04",
          "port": 0
        },
        {
          "id": "604ae411.82dfac",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "e1915b16.64af68",
    "type": "subflow",
    "name": "Motion Light",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 60,
        "y": 180,
        "wires": [
          {
            "id": "56ee4cfd.f5b314"
          }
        ]
      }
    ],
    "out": [],
    "status": {
      "x": 800,
      "y": 40,
      "wires": [
        {
          "id": "33be2e20.a89fe2",
          "port": 0
        },
        {
          "id": "2c54b49.68e174c",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "41fd29d8.74672",
    "type": "subflow",
    "name": "Lock/Unlock Door With Notification",
    "info": "",
    "category": "",
    "in": [
      {
        "x": 60,
        "y": 120,
        "wires": [
          {
            "id": "69eba8b5.83af88"
          }
        ]
      }
    ],
    "out": [
      {
        "x": 840,
        "y": 80,
        "wires": [
          {
            "id": "f069288c.f4d94",
            "port": 0
          },
          {
            "id": "648de272.3fb3ac",
            "port": 0
          }
        ]
      }
    ],
    "env": [],
    "status": {
      "x": 220,
      "y": 40,
      "wires": [
        {
          "id": "3bd505bb.e7187a",
          "port": 0
        }
      ]
    }
  },
  {
    "id": "61956bd4.93df44",
    "type": "server",
    "z": "",
    "name": "Home Assistant",
    "legacy": false,
    "hassio": true,
    "rejectUnauthorizedCerts": true,
    "ha_boolean": "y|yes|true|on|home|open",
    "connectionDelay": true
  },
  {
    "id": "a7b53d40.832918",
    "type": "inject",
    "z": "799d79fb.77ee38",
    "name": "",
    "topic": "",
    "payload": "on",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 110,
    "y": 80,
    "wires": [
      [
        "b4bc7fe7.6ac66"
      ]
    ]
  },
  {
    "id": "fc3c12d6.355eb8",
    "type": "inject",
    "z": "799d79fb.77ee38",
    "name": "",
    "topic": "",
    "payload": "off",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 110,
    "y": 120,
    "wires": [
      [
        "b4bc7fe7.6ac66"
      ]
    ]
  },
  {
    "id": "b4bc7fe7.6ac66",
    "type": "bigtimer",
    "z": "799d79fb.77ee38",
    "outtopic": "",
    "outpayload1": "on",
    "outpayload2": "off",
    "name": "Bedroom Fan",
    "comment": "Turn on at 9:00pm and off at 9:00am",
    "lat": "44.62617737045897",
    "lon": "-88.03619097769018",
    "starttime": "1260",
    "endtime": "480",
    "startoff": "0",
    "endoff": 0,
    "offs": 0,
    "outtext1": "",
    "outtext2": "",
    "timeout": "240",
    "sun": true,
    "mon": true,
    "tue": true,
    "wed": true,
    "thu": true,
    "fri": true,
    "sat": true,
    "jan": true,
    "feb": true,
    "mar": true,
    "apr": true,
    "may": true,
    "jun": true,
    "jul": true,
    "aug": true,
    "sep": true,
    "oct": true,
    "nov": true,
    "dec": true,
    "day1": 0,
    "month1": 0,
    "day2": 0,
    "month2": 0,
    "day3": 0,
    "month3": 0,
    "day4": 0,
    "month4": 0,
    "day5": 0,
    "month5": 0,
    "day6": 0,
    "month6": 0,
    "d1": 0,
    "w1": 0,
    "d2": 0,
    "w2": 0,
    "d3": 0,
    "w3": 0,
    "d4": 0,
    "w4": 0,
    "d5": 0,
    "w5": 0,
    "d6": 0,
    "w6": 0,
    "xday1": 0,
    "xmonth1": 0,
    "xday2": 0,
    "xmonth2": 0,
    "xday3": 0,
    "xmonth3": 0,
    "xday4": 0,
    "xmonth4": 0,
    "xday5": 0,
    "xmonth5": 0,
    "xday6": 0,
    "xmonth6": 0,
    "xd1": 0,
    "xw1": 0,
    "xd2": 0,
    "xw2": 0,
    "xd3": 0,
    "xw3": 0,
    "xd4": 0,
    "xw4": 0,
    "xd5": 0,
    "xw5": 0,
    "xd6": 0,
    "xw6": 0,
    "suspend": false,
    "random": false,
    "repeat": true,
    "atstart": true,
    "odd": false,
    "even": false,
    "x": 340,
    "y": 100,
    "wires": [
      [
        "5c9c9852.6ecc8"
      ],
      [],
      []
    ]
  },
  {
    "id": "28aa99c9.8b6e8e",
    "type": "inject",
    "z": "799d79fb.77ee38",
    "name": "",
    "topic": "",
    "payload": "auto",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 110,
    "y": 160,
    "wires": [
      [
        "b4bc7fe7.6ac66"
      ]
    ]
  },
  {
    "id": "5c9c9852.6ecc8",
    "type": "api-current-state",
    "z": "799d79fb.77ee38",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 560,
    "y": 100,
    "wires": [
      [
        "a6188fac.e0fa18"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "a6188fac.e0fa18",
    "type": "api-current-state",
    "z": "799d79fb.77ee38",
    "name": "Master Bedroom Fan Automation Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_master_bedroom_fan",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 870,
    "y": 100,
    "wires": [
      [
        "62c4cac9.de4d7c"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "4e282e0f.3d0c78",
    "type": "api-current-state",
    "z": "f67c7a34.9bcde",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 560,
    "y": 100,
    "wires": [
      [
        "7b5360fd.0c62d"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "7b5360fd.0c62d",
    "type": "api-current-state",
    "z": "f67c7a34.9bcde",
    "name": "Outside Front Lights On Motion Automation Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_outside_front_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 900,
    "y": 100,
    "wires": [
      [
        "886ea402.c9e02"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "fdc2811b.6677c",
    "type": "inject",
    "z": "f67c7a34.9bcde",
    "name": "",
    "topic": "",
    "payload": "on",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 90,
    "y": 80,
    "wires": [
      [
        "c7425af2.f1b6e8"
      ]
    ]
  },
  {
    "id": "c63bf66a.b8161",
    "type": "inject",
    "z": "f67c7a34.9bcde",
    "name": "",
    "topic": "",
    "payload": "off",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 90,
    "y": 120,
    "wires": [
      [
        "c7425af2.f1b6e8"
      ]
    ]
  },
  {
    "id": "c7425af2.f1b6e8",
    "type": "bigtimer",
    "z": "f67c7a34.9bcde",
    "outtopic": "",
    "outpayload1": "on",
    "outpayload2": "off",
    "name": "Outside Front Light",
    "comment": "Turn on Outside Front Lights at Sunset and turn off at 10pm",
    "lat": "44.62617737045897",
    "lon": "-88.03619097769018",
    "starttime": "5004",
    "endtime": "1320",
    "startoff": "0",
    "endoff": 0,
    "startoff2": "",
    "endoff2": "",
    "offs": 0,
    "outtext1": "",
    "outtext2": "",
    "timeout": "240",
    "sun": true,
    "mon": true,
    "tue": true,
    "wed": true,
    "thu": true,
    "fri": true,
    "sat": true,
    "jan": true,
    "feb": true,
    "mar": true,
    "apr": true,
    "may": true,
    "jun": true,
    "jul": true,
    "aug": true,
    "sep": true,
    "oct": true,
    "nov": true,
    "dec": true,
    "day1": 0,
    "month1": 0,
    "day2": 0,
    "month2": 0,
    "day3": 0,
    "month3": 0,
    "day4": 0,
    "month4": 0,
    "day5": 0,
    "month5": 0,
    "day6": 0,
    "month6": 0,
    "d1": 0,
    "w1": 0,
    "d2": 0,
    "w2": 0,
    "d3": 0,
    "w3": 0,
    "d4": 0,
    "w4": 0,
    "d5": 0,
    "w5": 0,
    "d6": 0,
    "w6": 0,
    "xday1": "21",
    "xmonth1": "12",
    "xday2": "24",
    "xmonth2": "12",
    "xday3": 0,
    "xmonth3": 0,
    "xday4": 0,
    "xmonth4": 0,
    "xday5": 0,
    "xmonth5": 0,
    "xday6": 0,
    "xmonth6": 0,
    "xd1": 0,
    "xw1": 0,
    "xd2": 0,
    "xw2": 0,
    "xd3": 0,
    "xw3": 0,
    "xd4": 0,
    "xw4": 0,
    "xd5": 0,
    "xw5": 0,
    "xd6": 0,
    "xw6": 0,
    "suspend": false,
    "random": false,
    "repeat": true,
    "atstart": true,
    "odd": false,
    "even": false,
    "x": 330,
    "y": 100,
    "wires": [
      [
        "4e282e0f.3d0c78"
      ],
      [],
      []
    ]
  },
  {
    "id": "ae5cc571.a4be68",
    "type": "inject",
    "z": "f67c7a34.9bcde",
    "name": "",
    "topic": "",
    "payload": "auto",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 90,
    "y": 160,
    "wires": [
      [
        "c7425af2.f1b6e8"
      ]
    ]
  },
  {
    "id": "1da28034.4b4418",
    "type": "inject",
    "z": "f67c7a34.9bcde",
    "name": "",
    "topic": "",
    "payload": "manual",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 90,
    "y": 200,
    "wires": [
      [
        "c7425af2.f1b6e8"
      ]
    ]
  },
  {
    "id": "9462d5b.b882228",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 380,
    "y": 40,
    "wires": [
      [
        "2c865b99.b709fc"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "2c865b99.b709fc",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Bathroom Fans Automation Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_inside_bathroom_fans",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 650,
    "y": 40,
    "wires": [
      [
        "ec9a7b3a.18fb28"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "cbe89c61.187578",
    "type": "inject",
    "z": "74ac8f9a.f9fa3",
    "name": "",
    "topic": "",
    "payload": "stop",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 180,
    "wires": [
      [
        "64bb5f39.4610d"
      ]
    ]
  },
  {
    "id": "ee0b92c2.059fd8",
    "type": "inject",
    "z": "799d79fb.77ee38",
    "name": "",
    "topic": "",
    "payload": "manual",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 110,
    "y": 200,
    "wires": [
      [
        "b4bc7fe7.6ac66"
      ]
    ]
  },
  {
    "id": "9e10eaf1.2846d",
    "type": "server-state-changed",
    "z": "74ac8f9a.f9fa3",
    "name": "First Floor Exhaust Fan",
    "server": "61956bd4.93df44",
    "entityidfilter": "switch.first_floor_bathroom_exhaust_fan",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 2,
    "x": 140,
    "y": 40,
    "wires": [
      [
        "9462d5b.b882228"
      ],
      []
    ]
  },
  {
    "id": "64bb5f39.4610d",
    "type": "stoptimer",
    "z": "74ac8f9a.f9fa3",
    "duration": "30",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "",
    "x": 300,
    "y": 120,
    "wires": [
      [
        "cd7937db.ba5d28"
      ],
      []
    ]
  },
  {
    "id": "ec9a7b3a.18fb28",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Fan Off?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "switch.first_floor_bathroom_exhaust_fan",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 120,
    "y": 120,
    "wires": [
      [
        "64bb5f39.4610d"
      ],
      []
    ]
  },
  {
    "id": "a9669035.881a28",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 420,
    "y": 260,
    "wires": [
      [
        "f53aed41.295838"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "f53aed41.295838",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Bathroom Fans Automation Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_inside_bathroom_fans",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 690,
    "y": 260,
    "wires": [
      [
        "9b84981b.c669b"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "6698260c.6de65",
    "type": "inject",
    "z": "74ac8f9a.f9fa3",
    "name": "",
    "topic": "",
    "payload": "stop",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 460,
    "wires": [
      [
        "41595ef1.c39598"
      ]
    ]
  },
  {
    "id": "b850b3.6495af5",
    "type": "server-state-changed",
    "z": "74ac8f9a.f9fa3",
    "name": "Kids Bathroom Exhaust Fan",
    "server": "61956bd4.93df44",
    "entityidfilter": "switch.kids_bathroom_exhaust_fan",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 2,
    "x": 160,
    "y": 260,
    "wires": [
      [
        "a9669035.881a28"
      ],
      []
    ]
  },
  {
    "id": "41595ef1.c39598",
    "type": "stoptimer",
    "z": "74ac8f9a.f9fa3",
    "duration": "45",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "",
    "x": 300,
    "y": 400,
    "wires": [
      [
        "8e11c2de.4e658"
      ],
      []
    ]
  },
  {
    "id": "9b84981b.c669b",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Fan Off?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "switch.kids_bathroom_exhaust_fan",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 120,
    "y": 400,
    "wires": [
      [
        "41595ef1.c39598"
      ],
      []
    ]
  },
  {
    "id": "145ebf02.48d239",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 460,
    "y": 520,
    "wires": [
      [
        "c7d7f88c.ecafd8"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "c7d7f88c.ecafd8",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Bathroom Fans Automation Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_inside_bathroom_fans",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 730,
    "y": 520,
    "wires": [
      [
        "6b605f3e.9bfa1"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "66046398.5493a4",
    "type": "inject",
    "z": "74ac8f9a.f9fa3",
    "name": "",
    "topic": "",
    "payload": "stop",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 760,
    "wires": [
      [
        "84bf3219.1c857"
      ]
    ]
  },
  {
    "id": "c8cd32af.bbd888",
    "type": "server-state-changed",
    "z": "74ac8f9a.f9fa3",
    "name": "Master Bathroom Exhaust Fan",
    "server": "61956bd4.93df44",
    "entityidfilter": "switch.master_bathroom_shower",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 2,
    "x": 160,
    "y": 520,
    "wires": [
      [
        "145ebf02.48d239"
      ],
      []
    ]
  },
  {
    "id": "84bf3219.1c857",
    "type": "stoptimer",
    "z": "74ac8f9a.f9fa3",
    "duration": "45",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "",
    "x": 300,
    "y": 700,
    "wires": [
      [
        "a231129a.d24d6"
      ],
      []
    ]
  },
  {
    "id": "6b605f3e.9bfa1",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Fan Off?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "switch.master_bathroom_shower",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 120,
    "y": 700,
    "wires": [
      [
        "84bf3219.1c857"
      ],
      []
    ]
  },
  {
    "id": "7a8081b7.4a989",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 440,
    "y": 860,
    "wires": [
      [
        "cfcadd62.0f1b88"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "cfcadd62.0f1b88",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Bathroom Fans Automation Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_inside_bathroom_fans",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 730,
    "y": 860,
    "wires": [
      [
        "c958e204.f1ba"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "b085ef50.e313e",
    "type": "inject",
    "z": "74ac8f9a.f9fa3",
    "name": "",
    "topic": "",
    "payload": "stop",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 1000,
    "wires": [
      [
        "761e84c7.e32b5c"
      ]
    ]
  },
  {
    "id": "db271ddf.9bc9e",
    "type": "server-state-changed",
    "z": "74ac8f9a.f9fa3",
    "name": "Master Watercloset Exhaust Fan",
    "server": "61956bd4.93df44",
    "entityidfilter": "switch.master_bathroom_water_closet",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 2,
    "x": 170,
    "y": 860,
    "wires": [
      [
        "7a8081b7.4a989"
      ],
      []
    ]
  },
  {
    "id": "761e84c7.e32b5c",
    "type": "stoptimer",
    "z": "74ac8f9a.f9fa3",
    "duration": "5",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "",
    "x": 320,
    "y": 940,
    "wires": [
      [
        "61b14f2e.97f7"
      ],
      []
    ]
  },
  {
    "id": "c958e204.f1ba",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Fan Off?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "switch.master_bathroom_water_closet",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 120,
    "y": 940,
    "wires": [
      [
        "761e84c7.e32b5c"
      ],
      []
    ]
  },
  {
    "id": "e949c86f.c9ca9",
    "type": "api-current-state",
    "z": "3c07a459.ce903c",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 560,
    "y": 100,
    "wires": [
      [
        "ec5308f5.aefff"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "ec5308f5.aefff",
    "type": "api-current-state",
    "z": "3c07a459.ce903c",
    "name": "Normalize Audio Levels?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_normalize_volume",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 810,
    "y": 100,
    "wires": [
      [
        "bde48ad8.814ac"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "dbf47096.3a7dc",
    "type": "inject",
    "z": "3c07a459.ce903c",
    "name": "",
    "topic": "",
    "payload": "on",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 110,
    "y": 80,
    "wires": [
      [
        "4608374e.2fd4d8"
      ]
    ]
  },
  {
    "id": "6eace9df.a5aa68",
    "type": "inject",
    "z": "3c07a459.ce903c",
    "name": "",
    "topic": "",
    "payload": "off",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 110,
    "y": 120,
    "wires": [
      [
        "4608374e.2fd4d8"
      ]
    ]
  },
  {
    "id": "4608374e.2fd4d8",
    "type": "bigtimer",
    "z": "3c07a459.ce903c",
    "outtopic": "",
    "outpayload1": ".3",
    "outpayload2": ".1",
    "name": "Normalize Audio",
    "comment": "Set audio to 40% from 9am to 9:30pm, otherwise set to 20%",
    "lat": "44.62617737045897",
    "lon": "-88.03619097769018",
    "starttime": "540",
    "endtime": "1170",
    "startoff": "0",
    "endoff": 0,
    "offs": 0,
    "outtext1": "",
    "outtext2": "",
    "timeout": "240",
    "sun": true,
    "mon": true,
    "tue": true,
    "wed": true,
    "thu": true,
    "fri": true,
    "sat": true,
    "jan": true,
    "feb": true,
    "mar": true,
    "apr": true,
    "may": true,
    "jun": true,
    "jul": true,
    "aug": true,
    "sep": true,
    "oct": true,
    "nov": true,
    "dec": true,
    "day1": 0,
    "month1": 0,
    "day2": 0,
    "month2": 0,
    "day3": 0,
    "month3": 0,
    "day4": 0,
    "month4": 0,
    "day5": 0,
    "month5": 0,
    "day6": 0,
    "month6": 0,
    "d1": 0,
    "w1": 0,
    "d2": 0,
    "w2": 0,
    "d3": 0,
    "w3": 0,
    "d4": 0,
    "w4": 0,
    "d5": 0,
    "w5": 0,
    "d6": 0,
    "w6": 0,
    "xday1": "21",
    "xmonth1": "12",
    "xday2": "24",
    "xmonth2": "12",
    "xday3": 0,
    "xmonth3": 0,
    "xday4": 0,
    "xmonth4": 0,
    "xday5": 0,
    "xmonth5": 0,
    "xday6": 0,
    "xmonth6": 0,
    "xd1": 0,
    "xw1": 0,
    "xd2": 0,
    "xw2": 0,
    "xd3": 0,
    "xw3": 0,
    "xd4": 0,
    "xw4": 0,
    "xd5": 0,
    "xw5": 0,
    "xd6": 0,
    "xw6": 0,
    "suspend": false,
    "random": false,
    "repeat": true,
    "atstart": true,
    "odd": false,
    "even": false,
    "x": 340,
    "y": 100,
    "wires": [
      [
        "e949c86f.c9ca9"
      ],
      [],
      []
    ]
  },
  {
    "id": "418865ec.975eec",
    "type": "inject",
    "z": "3c07a459.ce903c",
    "name": "",
    "topic": "",
    "payload": "auto",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 110,
    "y": 160,
    "wires": [
      [
        "4608374e.2fd4d8"
      ]
    ]
  },
  {
    "id": "e314dd72.39afe",
    "type": "inject",
    "z": "3c07a459.ce903c",
    "name": "",
    "topic": "",
    "payload": "manual",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 110,
    "y": 200,
    "wires": [
      [
        "4608374e.2fd4d8"
      ]
    ]
  },
  {
    "id": "89300b1.595bcf8",
    "type": "function",
    "z": "7a62a2d3.c0f4a4",
    "name": "Set Speech Payload",
    "func": "const entity = (msg.payload && msg.payload.entity_id) || \"media_player.office_echo_plus\";\nconst message = (msg.payload && msg.payload.message) || \"Automation provided no message\";\n\nconst playload = {\n    data: {\n        message: message,\n        data: { type: \"tts\" },\n        target: [entity]\n    }\n};\n\nnode.status({ fill: \"green\", shape: \"dot\", text: \"TTS message:\" + message });\nflow.set(\"speech_payload\", playload);\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 220,
    "y": 100,
    "wires": [
      [
        "6add9bc6.4c3624"
      ]
    ]
  },
  {
    "id": "3aff0264.75f63e",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "",
    "topic": "",
    "payload": "{\"entity_id\":\"media_player.office_echo_plus\",\"message\":\"test\"}",
    "payloadType": "json",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 60,
    "wires": [
      [
        "620542cf.f6445c"
      ]
    ]
  },
  {
    "id": "d44cc51a.be0668",
    "type": "api-call-service",
    "z": "7a62a2d3.c0f4a4",
    "name": "Send Speech Notification",
    "server": "61956bd4.93df44",
    "service_domain": "notify",
    "service": "alexa_media",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 910,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "6add9bc6.4c3624",
    "type": "api-current-state",
    "z": "7a62a2d3.c0f4a4",
    "name": "Speech Notifications?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_notifications",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 460,
    "y": 100,
    "wires": [
      [
        "a928caf.9ae70b8"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "a928caf.9ae70b8",
    "type": "change",
    "z": "7a62a2d3.c0f4a4",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "speech_payload",
        "tot": "flow"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 680,
    "y": 100,
    "wires": [
      [
        "d44cc51a.be0668"
      ]
    ]
  },
  {
    "id": "bd00a3a6.4710b",
    "type": "comment",
    "z": "7dca484b.45ae",
    "name": "Reads entity_id and message from the flow and sends the message",
    "info": "",
    "x": 300,
    "y": 20,
    "wires": []
  },
  {
    "id": "620542cf.f6445c",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "7dca484b.45ae",
    "name": "Send Automation Speech Notification",
    "x": 370,
    "y": 60,
    "wires": [
      []
    ]
  },
  {
    "id": "563c252e.ce31e4",
    "type": "function",
    "z": "974adda.d2ea92",
    "name": "Set Volume Level Payload",
    "func": "const entity = msg.payload && msg.payload.entity_id;\nconst attributes = msg.data && msg.data.attributes\nif (!entity || !attributes) {\n    node.status({ fill: \"red\", shape: \"dot\", text: \"Invalid volume payload\" });\n    return [null, null];\n}\n\nconst desired_volume_level = msg.payload.volume_level || 0;\nif (desired_volume_level < 0.0 || desired_volume_level > 1.0) {\n    let message = \"Volume level must be between 0 and 1.\"; \n    node.status({ fill: \"red\", shape: \"dot\", text: message });\n    node.error(message);\n    \n    return [null, { \n        payload: {\n            entity_id: entity,\n            message: message\n        }\n    }];\n}\n\nif (desired_volume_level === attributes.volume_level) {\n    let message = \"Volume level is already at the desired level.\"; \n    node.status({ fill: \"grey\", shape: \"dot\", text: message });\n    node.log(message);\n    return [null, { \n        payload: {\n            entity_id: entity,\n            message: message\n        }\n    }];\n}\n\nconst volumePayload = { \n    payload: {\n        data: {\n            entity_id: entity,\n            volume_level: desired_volume_level\n        } \n    }\n};\n\nlet message = \"Setting Volume Level to \" + (desired_volume_level * 100) + \" percent.\";\nconst speechPayload = { \n    payload: {\n        entity_id: entity,\n        message: message\n    }\n};\n\nnode.status({ fill: \"green\", shape: \"dot\", text: message });\nreturn [volumePayload, speechPayload];",
    "outputs": 2,
    "noerr": 0,
    "x": 510,
    "y": 120,
    "wires": [
      [
        "263d05a1.5b6672"
      ],
      [
        "b41308c0.f41e9"
      ]
    ],
    "inputLabels": [
      "Volume Percentage"
    ],
    "outputLabels": [
      "Volume Level Payload",
      "Speech Notification Payload"
    ]
  },
  {
    "id": "1f05212c.31d307",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "",
    "topic": "",
    "payload": "{\"entity_id\":\"media_player.office_echo_plus\",\"volume_level\":0.4}",
    "payloadType": "json",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 160,
    "wires": [
      [
        "62b0285a.e99958"
      ]
    ]
  },
  {
    "id": "263d05a1.5b6672",
    "type": "api-call-service",
    "z": "974adda.d2ea92",
    "name": "Set Volume Level",
    "server": "61956bd4.93df44",
    "service_domain": "media_player",
    "service": "volume_set",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 770,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "b41308c0.f41e9",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "974adda.d2ea92",
    "name": "",
    "env": [],
    "x": 830,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "62b0285a.e99958",
    "type": "subflow:974adda.d2ea92",
    "z": "7dca484b.45ae",
    "name": "",
    "x": 310,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "1c9baf90.4f6c98",
    "type": "comment",
    "z": "7dca484b.45ae",
    "name": "Reads entity_id and volume_level from the flow and sets the volume level and sends a notification",
    "info": "",
    "x": 390,
    "y": 120,
    "wires": []
  },
  {
    "id": "4c86fd47.0875e4",
    "type": "api-current-state",
    "z": "974adda.d2ea92",
    "name": "Get Current Volume Level",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": false,
    "override_data": true,
    "x": 250,
    "y": 120,
    "wires": [
      [
        "563c252e.ce31e4"
      ]
    ]
  },
  {
    "id": "f467a711.24ca3",
    "type": "ha-get-entities",
    "z": "76be143e.dbb0e4",
    "server": "61956bd4.93df44",
    "name": "Get All Media Players",
    "rules": [
      {
        "property": "attributes.supported_features",
        "logic": "is",
        "value": "23357",
        "valueType": "num"
      },
      {
        "property": "attributes.available",
        "logic": "is",
        "value": "true",
        "valueType": "bool"
      }
    ],
    "output_type": "split",
    "output_empty_results": true,
    "output_location_type": "msg",
    "output_location": "payload",
    "output_results_count": 1,
    "x": 480,
    "y": 120,
    "wires": [
      [
        "1fe46c89.0e0543"
      ]
    ]
  },
  {
    "id": "1fe46c89.0e0543",
    "type": "change",
    "z": "76be143e.dbb0e4",
    "name": "Set Volume Level",
    "rules": [
      {
        "t": "set",
        "p": "payload.volume_level",
        "pt": "msg",
        "to": "volume_level",
        "tot": "flow"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 710,
    "y": 120,
    "wires": [
      [
        "15d5ddae.8f64c2"
      ]
    ]
  },
  {
    "id": "642c5f33.bd92a8",
    "type": "function",
    "z": "76be143e.dbb0e4",
    "name": "Set Volume Level",
    "func": "const volumeLevel = parseFloat(msg.payload);\nnode.status({ fill: \"green\", shape: \"dot\", text: \"Volume Level: \" + volumeLevel });\nflow.set(\"volume_level\", volumeLevel);\nreturn msg;",
    "outputs": 1,
    "noerr": 0,
    "x": 250,
    "y": 120,
    "wires": [
      [
        "f467a711.24ca3"
      ]
    ]
  },
  {
    "id": "43b5f55b.765934",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "",
    "topic": "",
    "payload": "0.4",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 260,
    "wires": [
      [
        "f79c5d4a.d345a"
      ]
    ]
  },
  {
    "id": "15d5ddae.8f64c2",
    "type": "subflow:974adda.d2ea92",
    "z": "76be143e.dbb0e4",
    "name": "",
    "env": [],
    "x": 930,
    "y": 120,
    "wires": [
      []
    ]
  },
  {
    "id": "f79c5d4a.d345a",
    "type": "subflow:76be143e.dbb0e4",
    "z": "7dca484b.45ae",
    "name": "",
    "x": 370,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "c25481f6.b2293",
    "type": "comment",
    "z": "7dca484b.45ae",
    "name": "Reads decimal value and sets the volume level and sends a notification to all media devices",
    "info": "",
    "x": 380,
    "y": 220,
    "wires": []
  },
  {
    "id": "bde48ad8.814ac",
    "type": "rbe",
    "z": "3c07a459.ce903c",
    "name": "Only allow changed values",
    "func": "rbei",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 480,
    "y": 180,
    "wires": [
      [
        "4173c48c.381f84"
      ]
    ]
  },
  {
    "id": "4173c48c.381f84",
    "type": "subflow:76be143e.dbb0e4",
    "z": "3c07a459.ce903c",
    "name": "",
    "x": 790,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "d45759b3.b76fe8",
    "type": "comment",
    "z": "3c07a459.ce903c",
    "name": "Set volume to 30% at 9am to 9:30pm, otherwise set to 10%",
    "info": "",
    "x": 260,
    "y": 40,
    "wires": []
  },
  {
    "id": "f921f00.4443b1",
    "type": "comment",
    "z": "f67c7a34.9bcde",
    "name": "Turn on front outside lights for two hours after sunset",
    "info": "",
    "x": 220,
    "y": 40,
    "wires": []
  },
  {
    "id": "40282bde.949efc",
    "type": "server-state-changed",
    "z": "f67c7a34.9bcde",
    "name": "Switch Turned On/Off?",
    "server": "61956bd4.93df44",
    "entityidfilter": "switch.front_door_can_motion_switch",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 1,
    "x": 120,
    "y": 260,
    "wires": [
      [
        "c7425af2.f1b6e8"
      ]
    ]
  },
  {
    "id": "ec23d317.74325",
    "type": "server-state-changed",
    "z": "799d79fb.77ee38",
    "name": "Switch Turned On/Off?",
    "server": "61956bd4.93df44",
    "entityidfilter": "fan.master_bedroom_fan_control_switch_level",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 1,
    "x": 140,
    "y": 260,
    "wires": [
      [
        "b4bc7fe7.6ac66"
      ]
    ]
  },
  {
    "id": "490acbf2.0a1bcc",
    "type": "comment",
    "z": "799d79fb.77ee38",
    "name": "Turn on master bedroom fan from 9pm till 8am",
    "info": "",
    "x": 220,
    "y": 40,
    "wires": []
  },
  {
    "id": "f9c1dfcd.af5168",
    "type": "comment",
    "z": "7dca484b.45ae",
    "name": "Turns On or Off a device with notifications",
    "info": "",
    "x": 220,
    "y": 320,
    "wires": []
  },
  {
    "id": "ec8c016d.181ff8",
    "type": "function",
    "z": "af0c5464.36789",
    "name": "Set Switch Payload",
    "func": "const entity = msg.payload && msg.payload.entity_id;\nconst attributes = msg.data && msg.data.attributes\nif (!entity || !attributes) {\n    node.status({ fill: \"red\", shape: \"dot\", text: \"Invalid switch payload\" });\n    return [null, null, null];\n}\n\nconst desired_state = msg.payload.state;\nif (!desired_state) {\n    let message = \"Invalid Switch State\";\n    node.status({ fill: \"red\", shape: \"dot\", text: message });\n    node.error(message);\n    return [null, null, { \n        payload: {\n            entity_id: entity,\n            message: message\n        }\n    }];\n}\n\nif (desired_state === msg.data.state) {\n    let message = \"Switch is already at the desired state.\";\n    node.status({ fill: \"grey\", shape: \"dot\", text: message });\n    node.log(message);\n    return [null, null, { \n        payload: {\n            entity_id: entity,\n            message: message\n        }\n    }];\n}\n\nconst turningOn = desired_state === \"on\";\nconst speechEntity = msg.payload.speech_entity_id;\nconst switchPayload = { \n    payload: {\n        data: {\n            entity_id: entity\n        } \n    }\n};\n\nlet message = \"Turning \" + (turningOn ? \"on\" : \"off\") + \" \" + attributes.friendly_name;\nconst speechPayload = { \n    payload: {\n        entity_id: speechEntity,\n        message: message\n    }\n};\n\nnode.status({ fill: \"green\", shape: \"dot\", text: message });\nreturn [turningOn ? switchPayload : null, !turningOn ? switchPayload : null, speechPayload];",
    "outputs": 3,
    "noerr": 0,
    "x": 470,
    "y": 180,
    "wires": [
      [
        "6aaaebf.24cf914"
      ],
      [
        "474efe46.a70ec"
      ],
      [
        "bbe7c02e.559dd"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload",
      "Switch Off Payload",
      "Speech Notification Payload"
    ]
  },
  {
    "id": "bbe7c02e.559dd",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "af0c5464.36789",
    "name": "",
    "x": 750,
    "y": 240,
    "wires": [
      []
    ]
  },
  {
    "id": "7b55b409.713bdc",
    "type": "api-current-state",
    "z": "af0c5464.36789",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": false,
    "override_data": true,
    "x": 250,
    "y": 180,
    "wires": [
      [
        "ec8c016d.181ff8"
      ]
    ]
  },
  {
    "id": "971fc69b.91697",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "Turn On",
    "topic": "",
    "payload": "{\"speech_entity_id\":\"media_player.kitchen_echo_plus\",\"entity_id\":\"switch.front_door_can_motion_switch\",\"state\":\"on\"}",
    "payloadType": "json",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 360,
    "wires": [
      [
        "423d7204.86312c"
      ]
    ]
  },
  {
    "id": "c21352ed.ac008",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "Turn Off",
    "topic": "",
    "payload": "{\"speech_entity_id\":\"media_player.kitchen_echo_plus\",\"entity_id\":\"switch.front_door_can_motion_switch\",\"state\":\"off\"}",
    "payloadType": "json",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 400,
    "wires": [
      [
        "423d7204.86312c"
      ]
    ]
  },
  {
    "id": "6aaaebf.24cf914",
    "type": "api-call-service",
    "z": "af0c5464.36789",
    "name": "Turning On Switch",
    "server": "61956bd4.93df44",
    "service_domain": "switch",
    "service": "turn_on",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 690,
    "y": 120,
    "wires": [
      []
    ]
  },
  {
    "id": "474efe46.a70ec",
    "type": "api-call-service",
    "z": "af0c5464.36789",
    "name": "Turning Off Switch",
    "server": "61956bd4.93df44",
    "service_domain": "switch",
    "service": "turn_off",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 690,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "423d7204.86312c",
    "type": "subflow:af0c5464.36789",
    "z": "7dca484b.45ae",
    "name": "",
    "x": 410,
    "y": 380,
    "wires": [
      []
    ]
  },
  {
    "id": "62c4cac9.de4d7c",
    "type": "rbe",
    "z": "799d79fb.77ee38",
    "name": "Only allow changed values",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 480,
    "y": 180,
    "wires": [
      [
        "e9a908d2.917bb"
      ]
    ]
  },
  {
    "id": "e9a908d2.917bb",
    "type": "function",
    "z": "799d79fb.77ee38",
    "name": "Configure Lights",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.master_bedroom_echo_plus\",\n        entity_id: \"fan.master_bedroom_fan_control_switch_level\",\n        speed: \"medium\",\n        state: msg.payload\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 720,
    "y": 180,
    "wires": [
      [
        "b0ce4d14.406ec8"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "886ea402.c9e02",
    "type": "rbe",
    "z": "f67c7a34.9bcde",
    "name": "Only allow changed values",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 440,
    "y": 180,
    "wires": [
      [
        "25292edd.82bf32"
      ]
    ]
  },
  {
    "id": "4209d677.7a2c68",
    "type": "subflow:af0c5464.36789",
    "z": "f67c7a34.9bcde",
    "name": "",
    "x": 950,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "25292edd.82bf32",
    "type": "function",
    "z": "f67c7a34.9bcde",
    "name": "Configure Lights",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.kitchen_echo_plus\",\n        entity_id: \"switch.front_door_can_motion_switch\",\n        state: msg.payload\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 680,
    "y": 180,
    "wires": [
      [
        "4209d677.7a2c68"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "e88079b1.74dd98",
    "type": "subflow:af0c5464.36789",
    "z": "74ac8f9a.f9fa3",
    "name": "",
    "x": 810,
    "y": 940,
    "wires": [
      []
    ]
  },
  {
    "id": "61b14f2e.97f7",
    "type": "function",
    "z": "74ac8f9a.f9fa3",
    "name": "Configure Fan",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.master_water_closet_ecobee_switch\",\n        entity_id: \"switch.master_bathroom_water_closet\",\n        state: \"off\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 540,
    "y": 940,
    "wires": [
      [
        "e88079b1.74dd98"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "154896b6.bde641",
    "type": "subflow:af0c5464.36789",
    "z": "74ac8f9a.f9fa3",
    "name": "",
    "x": 770,
    "y": 700,
    "wires": [
      []
    ]
  },
  {
    "id": "a231129a.d24d6",
    "type": "function",
    "z": "74ac8f9a.f9fa3",
    "name": "Configure Fan",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.master_bathroom_ecobee_switch\",\n        entity_id: \"switch.master_bathroom_shower\",\n        state: \"off\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 500,
    "y": 700,
    "wires": [
      [
        "154896b6.bde641"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "9be33e26.1a6e5",
    "type": "subflow:af0c5464.36789",
    "z": "74ac8f9a.f9fa3",
    "name": "",
    "x": 770,
    "y": 400,
    "wires": [
      []
    ]
  },
  {
    "id": "8e11c2de.4e658",
    "type": "function",
    "z": "74ac8f9a.f9fa3",
    "name": "Configure Fan",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.kids_bathroom_ecobee_switch\",\n        entity_id: \"switch.kids_bathroom_exhaust_fan\",\n        state: \"off\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 500,
    "y": 400,
    "wires": [
      [
        "9be33e26.1a6e5"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "bd4ecf6b.865d4",
    "type": "subflow:af0c5464.36789",
    "z": "74ac8f9a.f9fa3",
    "name": "",
    "x": 770,
    "y": 120,
    "wires": [
      []
    ]
  },
  {
    "id": "cd7937db.ba5d28",
    "type": "function",
    "z": "74ac8f9a.f9fa3",
    "name": "Configure Fan",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.first_floor_bathroom_ecobee_switch\",\n        entity_id: \"switch.first_floor_bathroom_exhaust_fan\",\n        state: \"off\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 500,
    "y": 120,
    "wires": [
      [
        "bd4ecf6b.865d4"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "ff627b07.ecb988",
    "type": "function",
    "z": "6325f627.09e548",
    "name": "Set Switch Payload",
    "func": "const entity = msg.payload && msg.payload.entity_id;\nconst attributes = msg.data && msg.data.attributes\nif (!entity || !attributes) {\n    node.status({ fill: \"red\", shape: \"dot\", text: \"Invalid fan payload\" });\n    return [null, null, null];\n}\n\nconst desired_state = msg.payload.state;\nif (!desired_state) {\n    let message = \"Invalid Fan State\";\n    node.status({ fill: \"red\", shape: \"dot\", text: message });\n    node.error(message);\n    return [null, null, { \n        payload: {\n            entity_id: entity,\n            message: message\n        }\n    }];\n}\n\nif (desired_state === msg.data.state) {\n    let message = \"Fan is already at the desired state.\";\n    node.status({ fill: \"grey\", shape: \"dot\", text: message });\n    node.log(message);\n    return [null, null, { \n        payload: {\n            entity_id: entity,\n            message: message \n        }\n    }];\n}\n\nconst switchPayload = { \n    payload: {\n        data: {\n            entity_id: entity\n        } \n    }\n};\n\nconst speechPayload = { \n    payload: {\n        entity_id: msg.payload.speech_entity_id\n    }\n};\n\nif (desired_state === \"on\") {\n    const speed = msg.payload.speed || \"medium\";\n    switchPayload.payload.data.speed = speed;\n    speechPayload.payload.message = \"Turning on \" + attributes.friendly_name + \" \" + speed + \" speed\";\n    \n    node.status({ fill: \"green\", shape: \"dot\", text: speechPayload.payload.message });\n    return [switchPayload, null, speechPayload];\n} else {\n    speechPayload.payload.message = \"Turning off \" + attributes.friendly_name;\n    \n    node.status({ fill: \"green\", shape: \"dot\", text: speechPayload.payload.message });\n    return [null, switchPayload, speechPayload];\n}\n\nlet message = \"Unknown desired switch state\";\nnode.status({ fill: \"red\", shape: \"dot\", text: message });\nnode.error(message);",
    "outputs": 3,
    "noerr": 0,
    "x": 450,
    "y": 200,
    "wires": [
      [
        "758f438a.0ca1d4"
      ],
      [
        "e1cd27f0.559aa"
      ],
      [
        "296a90d4.769178"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload",
      "Switch Off Payload",
      "Speech Notification Payload"
    ]
  },
  {
    "id": "296a90d4.769178",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "6325f627.09e548",
    "name": "",
    "env": [],
    "x": 770,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "aec6edc3.91bb2",
    "type": "api-current-state",
    "z": "6325f627.09e548",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": false,
    "override_data": true,
    "x": 230,
    "y": 200,
    "wires": [
      [
        "ff627b07.ecb988"
      ]
    ]
  },
  {
    "id": "758f438a.0ca1d4",
    "type": "api-call-service",
    "z": "6325f627.09e548",
    "name": "Turning On Fan",
    "server": "61956bd4.93df44",
    "service_domain": "fan",
    "service": "turn_on",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 700,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "e1cd27f0.559aa",
    "type": "api-call-service",
    "z": "6325f627.09e548",
    "name": "Turning Off Fan",
    "server": "61956bd4.93df44",
    "service_domain": "fan",
    "service": "turn_off",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 700,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "29d94031.ce1478",
    "type": "comment",
    "z": "7dca484b.45ae",
    "name": "Turns On or Off a device with notifications",
    "info": "",
    "x": 220,
    "y": 460,
    "wires": []
  },
  {
    "id": "db6e22d1.91bb4",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "Turn On",
    "topic": "",
    "payload": "{\"speech_entity_id\":\"media_player.office_echo_plus\",\"entity_id\":\"fan.office_fan_control_switch_level\",\"state\":\"on\"}",
    "payloadType": "json",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 500,
    "wires": [
      [
        "4ab8cd93.8df4d4"
      ]
    ]
  },
  {
    "id": "9089beb.642624",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "Turn Off",
    "topic": "",
    "payload": "{\"speech_entity_id\":\"media_player.office_echo_plus\",\"entity_id\":\"fan.office_fan_control_switch_level\",\"state\":\"off\"}",
    "payloadType": "json",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 540,
    "wires": [
      [
        "4ab8cd93.8df4d4"
      ]
    ]
  },
  {
    "id": "4ab8cd93.8df4d4",
    "type": "subflow:6325f627.09e548",
    "z": "7dca484b.45ae",
    "name": "",
    "env": [],
    "x": 400,
    "y": 520,
    "wires": [
      []
    ]
  },
  {
    "id": "b0ce4d14.406ec8",
    "type": "subflow:6325f627.09e548",
    "z": "799d79fb.77ee38",
    "name": "",
    "x": 980,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "15a6bc16.d544dc",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 160,
    "y": 860,
    "wires": [
      [
        "e8c26c4c.91fbc"
      ]
    ]
  },
  {
    "id": "e8c26c4c.91fbc",
    "type": "api-current-state",
    "z": "7dca484b.45ae",
    "name": "zwave.master_bedroom_closet_motion_dimmer",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "zwave.master_bedroom_closet_motion_dimmer",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 440,
    "y": 860,
    "wires": [
      [
        "d6ab8388.d6b07"
      ]
    ]
  },
  {
    "id": "d6ab8388.d6b07",
    "type": "debug",
    "z": "7dca484b.45ae",
    "name": "zwave.master_bedroom_closet_motion_dimmer",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 820,
    "y": 860,
    "wires": []
  },
  {
    "id": "a151a6a4.6db608",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 160,
    "y": 920,
    "wires": [
      [
        "10afbda8.2fac0a"
      ]
    ]
  },
  {
    "id": "10afbda8.2fac0a",
    "type": "api-current-state",
    "z": "7dca484b.45ae",
    "name": "sensor.master_bedroom_closet_motion_dimmer_burglar",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "sensor.master_bedroom_closet_motion_dimmer_burglar",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 470,
    "y": 920,
    "wires": [
      [
        "332ca293.1f9aa6"
      ]
    ]
  },
  {
    "id": "332ca293.1f9aa6",
    "type": "debug",
    "z": "7dca484b.45ae",
    "name": "sensor.master_bedroom_closet_motion_dimmer_burglar",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 970,
    "y": 920,
    "wires": []
  },
  {
    "id": "b6d13790.27ec9",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 160,
    "y": 980,
    "wires": [
      [
        "74ae1692.450828"
      ]
    ]
  },
  {
    "id": "74ae1692.450828",
    "type": "api-current-state",
    "z": "7dca484b.45ae",
    "name": "sensor.august_smart_lock_gen3_front_door_access_control",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "sensor.august_smart_lock_gen3_front_door_access_control",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 480,
    "y": 980,
    "wires": [
      [
        "75ac9684.3cc3f"
      ]
    ]
  },
  {
    "id": "75ac9684.3cc3f",
    "type": "debug",
    "z": "7dca484b.45ae",
    "name": "sensor.august_smart_lock_gen3_front_door_access_control",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 960,
    "y": 980,
    "wires": []
  },
  {
    "id": "492fbd80.120b44",
    "type": "server-state-changed",
    "z": "7dca484b.45ae",
    "name": "",
    "server": "61956bd4.93df44",
    "entityidfilter": "event.ifttt_webhook_received",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 270,
    "y": 760,
    "wires": [
      [
        "1f45fdce.1cee22"
      ]
    ]
  },
  {
    "id": "1f45fdce.1cee22",
    "type": "debug",
    "z": "7dca484b.45ae",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 550,
    "y": 760,
    "wires": []
  },
  {
    "id": "8b49cee1.fddc9",
    "type": "api-current-state",
    "z": "5bb10f4e.f7bd8",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 400,
    "y": 60,
    "wires": [
      [
        "f8cbd2c0.6f419"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "a4dfce13.6627d",
    "type": "server-state-changed",
    "z": "5bb10f4e.f7bd8",
    "name": "Washing Machine",
    "server": "61956bd4.93df44",
    "entityidfilter": "switch.washer",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": false,
    "x": 170,
    "y": 60,
    "wires": [
      [
        "8b49cee1.fddc9"
      ],
      []
    ]
  },
  {
    "id": "f8cbd2c0.6f419",
    "type": "rbe",
    "z": "5bb10f4e.f7bd8",
    "name": "Only allow changed values",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 280,
    "y": 140,
    "wires": [
      [
        "73459173.276d7"
      ]
    ]
  },
  {
    "id": "2e626a8f.8e3db6",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "5bb10f4e.f7bd8",
    "name": "",
    "x": 810,
    "y": 140,
    "wires": [
      []
    ]
  },
  {
    "id": "73459173.276d7",
    "type": "function",
    "z": "5bb10f4e.f7bd8",
    "name": "Set Switch Payload",
    "func": "const turningOn = msg.payload && msg.payload.state === \"on\";\nreturn { \n    payload: {\n        entity_id: \"media_player.laundry_room_ecobee_switch\",\n        message: \"Turning \" + (turningOn ? \"on\" : \"off\") + \" \" + attributes.friendly_name\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 530,
    "y": 140,
    "wires": [
      [
        "2e626a8f.8e3db6"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "aac7a879.4b3068",
    "type": "api-current-state",
    "z": "5bb10f4e.f7bd8",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 400,
    "y": 200,
    "wires": [
      [
        "1f9dbfe6.ee65"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "465d60a8.4b85c",
    "type": "server-state-changed",
    "z": "5bb10f4e.f7bd8",
    "name": "Dryer",
    "server": "61956bd4.93df44",
    "entityidfilter": "switch.dryer",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": false,
    "x": 130,
    "y": 200,
    "wires": [
      [
        "aac7a879.4b3068"
      ],
      []
    ]
  },
  {
    "id": "1f9dbfe6.ee65",
    "type": "rbe",
    "z": "5bb10f4e.f7bd8",
    "name": "Only allow changed values",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 280,
    "y": 280,
    "wires": [
      [
        "da077a17.4658c8"
      ]
    ]
  },
  {
    "id": "ce0a9d2f.c6d27",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "5bb10f4e.f7bd8",
    "name": "",
    "x": 810,
    "y": 280,
    "wires": [
      []
    ]
  },
  {
    "id": "da077a17.4658c8",
    "type": "function",
    "z": "5bb10f4e.f7bd8",
    "name": "Set Switch Payload",
    "func": "const turningOn = msg.payload && msg.payload.state === \"on\";\nreturn { \n    payload: {\n        entity_id: \"media_player.laundry_room_ecobee_switch\",\n        message: \"Turning \" + (turningOn ? \"on\" : \"off\") + \" \" + attributes.friendly_name\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 530,
    "y": 280,
    "wires": [
      [
        "ce0a9d2f.c6d27"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "4e95be49.15fe7",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 360,
    "y": 120,
    "wires": [
      [
        "3f0b5548.321332"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "3f0b5548.321332",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Turn off Closet Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_inside_closet_lights",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 600,
    "y": 120,
    "wires": [
      [
        "5d804156.c59b88"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "87079489.46a32",
    "type": "inject",
    "z": "cd444af.6970f38",
    "name": "",
    "topic": "",
    "payload": "stop",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 260,
    "wires": [
      [
        "e06034d2.01243"
      ]
    ]
  },
  {
    "id": "a3d7963d.500a",
    "type": "server-state-changed",
    "z": "cd444af.6970f38",
    "name": "Office Closet Lights",
    "server": "61956bd4.93df44",
    "entityidfilter": "switch.office_closet_main_lights",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 2,
    "x": 130,
    "y": 120,
    "wires": [
      [
        "4e95be49.15fe7"
      ],
      []
    ]
  },
  {
    "id": "e06034d2.01243",
    "type": "stoptimer",
    "z": "cd444af.6970f38",
    "duration": "15",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "",
    "x": 320,
    "y": 200,
    "wires": [
      [
        "d66f6327.7c9e2"
      ],
      []
    ]
  },
  {
    "id": "5d804156.c59b88",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Light Off?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "switch.office_closet_main_lights",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 120,
    "y": 200,
    "wires": [
      [
        "e06034d2.01243"
      ],
      []
    ]
  },
  {
    "id": "7bcadb48.cc2fac",
    "type": "subflow:af0c5464.36789",
    "z": "cd444af.6970f38",
    "name": "",
    "x": 810,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "d66f6327.7c9e2",
    "type": "function",
    "z": "cd444af.6970f38",
    "name": "Configure Light",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.office_echo_plus\",\n        entity_id: \"switch.office_closet_main_lights\",\n        state: \"off\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 540,
    "y": 200,
    "wires": [
      [
        "7bcadb48.cc2fac"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "fded526d.230b68",
    "type": "comment",
    "z": "cd444af.6970f38",
    "name": "Automatically Turn off Closet Lights after 15 minutes",
    "info": "",
    "x": 230,
    "y": 60,
    "wires": []
  },
  {
    "id": "93f8da04.fcf1",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 420,
    "y": 560,
    "wires": [
      [
        "2e07e00d.dc767"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "2e07e00d.dc767",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Turn off Closet Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_inside_closet_lights",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 660,
    "y": 560,
    "wires": [
      [
        "c6222c92.3df43"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "9cfcfec4.497718",
    "type": "inject",
    "z": "cd444af.6970f38",
    "name": "",
    "topic": "",
    "payload": "stop",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 700,
    "wires": [
      [
        "255f5cae.a4f20c"
      ]
    ]
  },
  {
    "id": "55e49e16.d753e",
    "type": "server-state-changed",
    "z": "cd444af.6970f38",
    "name": "Kids Room One Closet Lights",
    "server": "61956bd4.93df44",
    "entityidfilter": "switch.kids_room_one_closet_main_lights",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 2,
    "x": 160,
    "y": 560,
    "wires": [
      [
        "93f8da04.fcf1"
      ],
      []
    ]
  },
  {
    "id": "255f5cae.a4f20c",
    "type": "stoptimer",
    "z": "cd444af.6970f38",
    "duration": "15",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "",
    "x": 320,
    "y": 640,
    "wires": [
      [
        "cbe37a42.5200a8"
      ],
      []
    ]
  },
  {
    "id": "c6222c92.3df43",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Light Off?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "switch.kids_room_one_closet_main_lights",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 120,
    "y": 640,
    "wires": [
      [
        "255f5cae.a4f20c"
      ],
      []
    ]
  },
  {
    "id": "c006a7db.4387b",
    "type": "subflow:af0c5464.36789",
    "z": "cd444af.6970f38",
    "name": "",
    "x": 810,
    "y": 640,
    "wires": [
      []
    ]
  },
  {
    "id": "cbe37a42.5200a8",
    "type": "function",
    "z": "cd444af.6970f38",
    "name": "Configure Light",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.kids_bedroom_one_ecobee_switch\",\n        entity_id: \"switch.kids_room_one_closet_main_lights\",\n        state: \"off\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 540,
    "y": 640,
    "wires": [
      [
        "c006a7db.4387b"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "7ab2c5fa.a059f4",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 420,
    "y": 780,
    "wires": [
      [
        "a0da0324.a5a71"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "a0da0324.a5a71",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Turn off Closet Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_inside_closet_lights",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 660,
    "y": 780,
    "wires": [
      [
        "640de76b.e28e98"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "1ee9684a.785d28",
    "type": "inject",
    "z": "cd444af.6970f38",
    "name": "",
    "topic": "",
    "payload": "stop",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 920,
    "wires": [
      [
        "1534f4cc.943853"
      ]
    ]
  },
  {
    "id": "1067debf.d44f31",
    "type": "server-state-changed",
    "z": "cd444af.6970f38",
    "name": "Kids Room two Closet Lights",
    "server": "61956bd4.93df44",
    "entityidfilter": "switch.kids_room_two_closet_main_lights",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 2,
    "x": 160,
    "y": 780,
    "wires": [
      [
        "7ab2c5fa.a059f4"
      ],
      []
    ]
  },
  {
    "id": "1534f4cc.943853",
    "type": "stoptimer",
    "z": "cd444af.6970f38",
    "duration": "15",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "",
    "x": 320,
    "y": 860,
    "wires": [
      [
        "77134e6b.f0628"
      ],
      []
    ]
  },
  {
    "id": "640de76b.e28e98",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Light Off?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "switch.kids_room_two_closet_main_lights",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 120,
    "y": 860,
    "wires": [
      [
        "1534f4cc.943853"
      ],
      []
    ]
  },
  {
    "id": "101ab1cc.f13136",
    "type": "subflow:af0c5464.36789",
    "z": "cd444af.6970f38",
    "name": "",
    "x": 810,
    "y": 860,
    "wires": [
      []
    ]
  },
  {
    "id": "77134e6b.f0628",
    "type": "function",
    "z": "cd444af.6970f38",
    "name": "Configure Light",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.kids_bedroom_two_ecobee_switch\",\n        entity_id: \"switch.kids_room_two_closet_main_lights\",\n        state: \"off\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 540,
    "y": 860,
    "wires": [
      [
        "101ab1cc.f13136"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "b78302a9.f3714",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 420,
    "y": 340,
    "wires": [
      [
        "f00cbb26.eaec2"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "f00cbb26.eaec2",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Turn off Closet Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_inside_closet_lights",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 660,
    "y": 340,
    "wires": [
      [
        "3c0885bd.5620c2"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "ce9d55d4.a0acf",
    "type": "inject",
    "z": "cd444af.6970f38",
    "name": "",
    "topic": "",
    "payload": "stop",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 480,
    "wires": [
      [
        "e561d1d9.dd7c6"
      ]
    ]
  },
  {
    "id": "ef2da4c8.fb1448",
    "type": "server-state-changed",
    "z": "cd444af.6970f38",
    "name": "Master Bedroom Closet Lights",
    "server": "61956bd4.93df44",
    "entityidfilter": "light.master_bedroom_closet_motion_dimmer_level",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 2,
    "x": 170,
    "y": 340,
    "wires": [
      [
        "b78302a9.f3714"
      ],
      []
    ]
  },
  {
    "id": "e561d1d9.dd7c6",
    "type": "stoptimer",
    "z": "cd444af.6970f38",
    "duration": "35",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "",
    "x": 320,
    "y": 420,
    "wires": [
      [
        "19d3c1da.87cede"
      ],
      []
    ]
  },
  {
    "id": "3c0885bd.5620c2",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Light Off?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "light.master_bedroom_closet_motion_dimmer_level",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 120,
    "y": 420,
    "wires": [
      [
        "e561d1d9.dd7c6"
      ],
      []
    ]
  },
  {
    "id": "19d3c1da.87cede",
    "type": "function",
    "z": "cd444af.6970f38",
    "name": "Configure Light",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.kids_bedroom_one_ecobee_switch\",\n        entity_id: \"light.master_bedroom_closet_motion_dimmer_level\",\n        state: \"off\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 540,
    "y": 420,
    "wires": [
      [
        "e037badf.2431f"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "b552312d.93ee18",
    "type": "function",
    "z": "bafd53de.69711",
    "name": "Set Switch Payload",
    "func": "const entity = msg.payload && msg.payload.entity_id;\nconst attributes = msg.data && msg.data.attributes\nif (!entity || !attributes) {\n    node.status({ fill: \"red\", shape: \"dot\", text: \"Invalid light payload\" });\n    return [null, null, null];\n}\n\nconst desired_state = msg.payload.state;\nif (!desired_state) {\n    let message = \"Invalid Light State\";\n    node.status({ fill: \"red\", shape: \"dot\", text: message });\n    node.error(message);\n    return [null, null, { \n        payload: {\n            entity_id: entity,\n            message: message\n        }\n    }];\n}\n\nif (desired_state === msg.data.state) {\n    let message = \"Light is already at the desired state.\";\n    node.status({ fill: \"grey\", shape: \"dot\", text: message });\n    node.log(\"Light is already at the desired state.\");\n    return [null, null, { \n        payload: {\n            entity_id: entity,\n            message: message\n        }\n    }];\n}\n\nconst turningOn = desired_state === \"on\";\nconst speechEntity = msg.payload.speech_entity_id;\nconst switchPayload = { \n    payload: {\n        data: {\n            entity_id: entity\n        } \n    }\n};\n\nlet message = \"Turning \" + (turningOn ? \"on\" : \"off\") + \" \" + attributes.friendly_name;\nconst speechPayload = { \n    payload: {\n        entity_id: speechEntity,\n        message: message\n    }\n};\n\nnode.status({ fill: \"green\", shape: \"dot\", text: message });\nreturn [turningOn ? switchPayload : null, !turningOn ? switchPayload : null, speechPayload];",
    "outputs": 3,
    "noerr": 0,
    "x": 470,
    "y": 200,
    "wires": [
      [
        "a90f2ebc.50003"
      ],
      [
        "e94b9746.e44b8"
      ],
      [
        "cd216534.820718"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload",
      "Switch Off Payload",
      "Speech Notification Payload"
    ]
  },
  {
    "id": "cd216534.820718",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "bafd53de.69711",
    "name": "",
    "x": 790,
    "y": 220,
    "wires": [
      []
    ]
  },
  {
    "id": "c6d3f892.6f2528",
    "type": "api-current-state",
    "z": "bafd53de.69711",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": false,
    "override_data": true,
    "x": 250,
    "y": 200,
    "wires": [
      [
        "b552312d.93ee18"
      ]
    ]
  },
  {
    "id": "a90f2ebc.50003",
    "type": "api-call-service",
    "z": "bafd53de.69711",
    "name": "Turning On Switch",
    "server": "61956bd4.93df44",
    "service_domain": "light",
    "service": "turn_on",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 730,
    "y": 100,
    "wires": [
      []
    ]
  },
  {
    "id": "e94b9746.e44b8",
    "type": "api-call-service",
    "z": "bafd53de.69711",
    "name": "Turning Off Switch",
    "server": "61956bd4.93df44",
    "service_domain": "light",
    "service": "turn_off",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 730,
    "y": 160,
    "wires": [
      []
    ]
  },
  {
    "id": "a87a4c12.54694",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "Turn On",
    "topic": "",
    "payload": "{\"speech_entity_id\":\"media_player.office_echo_plus\",\"entity_id\":\"light.master_bedroom_closet_motion_dimmer_level\",\"state\":\"on\"}",
    "payloadType": "json",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 640,
    "wires": [
      [
        "8def0c3d.76eb48"
      ]
    ]
  },
  {
    "id": "5ab37aec.ddcc1c",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "Turn Off",
    "topic": "",
    "payload": "{\"speech_entity_id\":\"media_player.office_echo_plus\",\"entity_id\":\"light.master_bedroom_closet_motion_dimmer_level\",\"state\":\"off\"}",
    "payloadType": "json",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 680,
    "wires": [
      [
        "8def0c3d.76eb48"
      ]
    ]
  },
  {
    "id": "8def0c3d.76eb48",
    "type": "subflow:bafd53de.69711",
    "z": "7dca484b.45ae",
    "name": "Turn Light On/Off With Notifications",
    "x": 380,
    "y": 660,
    "wires": [
      []
    ]
  },
  {
    "id": "54972408.01e4a4",
    "type": "comment",
    "z": "7dca484b.45ae",
    "name": "Turns On or Off a device with notifications",
    "info": "",
    "x": 220,
    "y": 600,
    "wires": []
  },
  {
    "id": "e037badf.2431f",
    "type": "subflow:bafd53de.69711",
    "z": "cd444af.6970f38",
    "name": "",
    "x": 800,
    "y": 420,
    "wires": [
      []
    ]
  },
  {
    "id": "42a158d8.28ea",
    "type": "comment",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Motion Lights",
    "info": "",
    "x": 220,
    "y": 40,
    "wires": []
  },
  {
    "id": "7111c192.b5cc28",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 440,
    "y": 180,
    "wires": [
      [
        "31f7666.1e3c21a"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "31f7666.1e3c21a",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 690,
    "y": 180,
    "wires": [
      [
        "6f6f8073.9a814"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "a57aeb98.a389f",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Guest Bedroom Occupancy",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.bedroom_occupancy",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 180,
    "y": 180,
    "wires": [
      [
        "7111c192.b5cc28"
      ],
      []
    ]
  },
  {
    "id": "5de5b5c6.6b452c",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1630,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "b964f06c.ec47d8",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.basement_bedroom_ecobee_switch\",\n        message: (attributes && attributes.friendly_name || \"Occupancy\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1350,
    "y": 180,
    "wires": [
      [
        "5de5b5c6.6b452c"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "4eb389c0.695f98",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1130,
    "y": 180,
    "wires": [
      [
        "b964f06c.ec47d8"
      ]
    ]
  },
  {
    "id": "6f6f8073.9a814",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 920,
    "y": 180,
    "wires": [
      [
        "4eb389c0.695f98"
      ]
    ]
  },
  {
    "id": "eaebfb95.11548",
    "type": "comment",
    "z": "edd021ae.2eeb9",
    "name": "Send Audio Notification when motion is detected",
    "info": "",
    "x": 240,
    "y": 60,
    "wires": []
  },
  {
    "id": "8e444d3.8ed9c3",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 460,
    "y": 660,
    "wires": [
      [
        "14bb765.776300a"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "14bb765.776300a",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 710,
    "y": 660,
    "wires": [
      [
        "9f2e47af.fb604"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "585ade85.ef8128",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Front Door Camera Person",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.front_door_camera_person_detected",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 200,
    "y": 660,
    "wires": [
      [
        "8e444d3.8ed9c3"
      ],
      []
    ]
  },
  {
    "id": "94be22d.983e2e",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1650,
    "y": 660,
    "wires": [
      []
    ]
  },
  {
    "id": "71f2608c.13f7b",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.foyer_ecobee_switch\",\n        message: (attributes && attributes.friendly_name || \"Person\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1370,
    "y": 660,
    "wires": [
      [
        "94be22d.983e2e"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "4d45ccc7.8b203c",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1150,
    "y": 660,
    "wires": [
      [
        "71f2608c.13f7b"
      ]
    ]
  },
  {
    "id": "9f2e47af.fb604",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 940,
    "y": 660,
    "wires": [
      [
        "4d45ccc7.8b203c"
      ]
    ]
  },
  {
    "id": "f60652e9.dee7e8",
    "type": "comment",
    "z": "edd021ae.2eeb9",
    "name": "Basement",
    "info": "",
    "x": 120,
    "y": 120,
    "wires": []
  },
  {
    "id": "77cc8fe4.4be308",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 440,
    "y": 260,
    "wires": [
      [
        "5c889d9a.49cd2c"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "5c889d9a.49cd2c",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 690,
    "y": 260,
    "wires": [
      [
        "4d7d507a.cf599"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "c518980d.9b4ff",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Exercise Room Occupancy",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.basement_occupancy",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 180,
    "y": 260,
    "wires": [
      [
        "77cc8fe4.4be308"
      ],
      []
    ]
  },
  {
    "id": "f597940c.c8bb7",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1630,
    "y": 260,
    "wires": [
      []
    ]
  },
  {
    "id": "1545b6c6.d63eb1",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.basement_window_echo\",\n        message: (attributes && attributes.friendly_name || \"Occupancy\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1350,
    "y": 260,
    "wires": [
      [
        "f597940c.c8bb7"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "462abe53.4585",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1130,
    "y": 260,
    "wires": [
      [
        "1545b6c6.d63eb1"
      ]
    ]
  },
  {
    "id": "4d7d507a.cf599",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 920,
    "y": 260,
    "wires": [
      [
        "462abe53.4585"
      ]
    ]
  },
  {
    "id": "3fa4e9a6.0be8ae",
    "type": "comment",
    "z": "edd021ae.2eeb9",
    "name": "First Floor",
    "info": "",
    "x": 140,
    "y": 600,
    "wires": []
  },
  {
    "id": "504afef9.c55a58",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 420,
    "y": 1200,
    "wires": [
      [
        "7ead1b7c.1a834c"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "7ead1b7c.1a834c",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 670,
    "y": 1200,
    "wires": [
      [
        "3a92644f.834924"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "b2e80148.0aefc8",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Back Hallway Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.back_hallway_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 180,
    "y": 1200,
    "wires": [
      [
        "504afef9.c55a58"
      ],
      []
    ]
  },
  {
    "id": "e0e13eec.0f072",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1610,
    "y": 1200,
    "wires": [
      []
    ]
  },
  {
    "id": "caaefc24.ea176",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.back_foyer_ecobee_switch\",\n        message: (attributes && attributes.friendly_name || \"Motion\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1330,
    "y": 1200,
    "wires": [
      [
        "e0e13eec.0f072"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "c8dc3aba.a853d8",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1110,
    "y": 1200,
    "wires": [
      [
        "caaefc24.ea176"
      ]
    ]
  },
  {
    "id": "3a92644f.834924",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 900,
    "y": 1200,
    "wires": [
      [
        "c8dc3aba.a853d8"
      ]
    ]
  },
  {
    "id": "7e7fc621.c3668",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 420,
    "y": 1420,
    "wires": [
      [
        "694c6d4d.326abc"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "694c6d4d.326abc",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 670,
    "y": 1420,
    "wires": [
      [
        "81f31b5a.3cc788"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "746a844.3f5a57c",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Upstairs Hallway Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.upstairs_hallway_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 190,
    "y": 1420,
    "wires": [
      [
        "7e7fc621.c3668"
      ],
      []
    ]
  },
  {
    "id": "f616a5da.3aafd",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1610,
    "y": 1420,
    "wires": [
      []
    ]
  },
  {
    "id": "cc5b74c7.084c8",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.media_player.kids_bathroom_ecobee_switch\",\n        message: (attributes && attributes.friendly_name || \"Motion\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1330,
    "y": 1420,
    "wires": [
      [
        "f616a5da.3aafd"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "cb71ff64.73e45",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1110,
    "y": 1420,
    "wires": [
      [
        "cc5b74c7.084c8"
      ]
    ]
  },
  {
    "id": "81f31b5a.3cc788",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 900,
    "y": 1420,
    "wires": [
      [
        "cb71ff64.73e45"
      ]
    ]
  },
  {
    "id": "522fca17.9b8604",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 460,
    "y": 720,
    "wires": [
      [
        "badd9d18.525ce"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "badd9d18.525ce",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 710,
    "y": 720,
    "wires": [
      [
        "bd76dc17.bc23a"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "2978c1e0.1d323e",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Front Foyer Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.front_foyer_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 170,
    "y": 720,
    "wires": [
      [
        "522fca17.9b8604"
      ],
      []
    ]
  },
  {
    "id": "ca80307f.fac2e",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1650,
    "y": 720,
    "wires": [
      []
    ]
  },
  {
    "id": "90ee0b62.39e43",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.foyer_ecobee_switch\",\n        message: (attributes && attributes.friendly_name || \"Motion\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1370,
    "y": 720,
    "wires": [
      [
        "ca80307f.fac2e"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "45132d7.51cd2d4",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1150,
    "y": 720,
    "wires": [
      [
        "90ee0b62.39e43"
      ]
    ]
  },
  {
    "id": "bd76dc17.bc23a",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 940,
    "y": 720,
    "wires": [
      [
        "45132d7.51cd2d4"
      ]
    ]
  },
  {
    "id": "4cbfa1a5.5958f",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 480,
    "y": 780,
    "wires": [
      [
        "14daee1b.d1bbda"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "14daee1b.d1bbda",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 730,
    "y": 780,
    "wires": [
      [
        "9f5a95d8.59f4b8"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "a89d8291.aaa95",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Front Foyer Right Closet Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.front_foyer_right_closet_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 210,
    "y": 780,
    "wires": [
      [
        "4cbfa1a5.5958f"
      ],
      []
    ]
  },
  {
    "id": "811c0b37.6df618",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1670,
    "y": 780,
    "wires": [
      []
    ]
  },
  {
    "id": "b85d6577.9beab",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.foyer_ecobee_switch\",\n        message: (attributes && attributes.friendly_name || \"Motion\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1390,
    "y": 780,
    "wires": [
      [
        "811c0b37.6df618"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "8b27f664.b23788",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1170,
    "y": 780,
    "wires": [
      [
        "b85d6577.9beab"
      ]
    ]
  },
  {
    "id": "9f5a95d8.59f4b8",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 960,
    "y": 780,
    "wires": [
      [
        "8b27f664.b23788"
      ]
    ]
  },
  {
    "id": "3df975ae.b6254a",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 460,
    "y": 840,
    "wires": [
      [
        "928e8d83.0a11d8"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "928e8d83.0a11d8",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 710,
    "y": 840,
    "wires": [
      [
        "705a4b81.2c49fc"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "7e58c574.127acc",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Living Room Occupancy",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.living_room_occupancy",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 190,
    "y": 840,
    "wires": [
      [
        "3df975ae.b6254a"
      ],
      []
    ]
  },
  {
    "id": "cfa58443.2a99d8",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1650,
    "y": 840,
    "wires": [
      []
    ]
  },
  {
    "id": "fa2afe91.ad23c8",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.living_room_ecobee_switch\",\n        message: (attributes && attributes.friendly_name || \"Occupancy\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1370,
    "y": 840,
    "wires": [
      [
        "cfa58443.2a99d8"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "cd7d051.3fbdbf8",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1150,
    "y": 840,
    "wires": [
      [
        "fa2afe91.ad23c8"
      ]
    ]
  },
  {
    "id": "705a4b81.2c49fc",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 940,
    "y": 840,
    "wires": [
      [
        "cd7d051.3fbdbf8"
      ]
    ]
  },
  {
    "id": "b52bedc6.7f6df8",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 460,
    "y": 900,
    "wires": [
      [
        "df5ae7e7.a4562"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "df5ae7e7.a4562",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 710,
    "y": 900,
    "wires": [
      [
        "6435eecf.40f4c8"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "262c8128.0ab45e",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Living Room Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.living_room_motion_detected",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 180,
    "y": 900,
    "wires": [
      [
        "b52bedc6.7f6df8"
      ],
      []
    ]
  },
  {
    "id": "436ea1c4.5e5a",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1650,
    "y": 900,
    "wires": [
      []
    ]
  },
  {
    "id": "efa58bb5.94ca",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.living_room_ecobee_switch\",\n        message: (attributes && attributes.friendly_name || \"Motion\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1370,
    "y": 900,
    "wires": [
      [
        "436ea1c4.5e5a"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "8c507a67.6eea18",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1150,
    "y": 900,
    "wires": [
      [
        "efa58bb5.94ca"
      ]
    ]
  },
  {
    "id": "6435eecf.40f4c8",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 940,
    "y": 900,
    "wires": [
      [
        "8c507a67.6eea18"
      ]
    ]
  },
  {
    "id": "2cb2a629.6cce0a",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 500,
    "y": 960,
    "wires": [
      [
        "77d5440.0af8a3c"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "77d5440.0af8a3c",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 750,
    "y": 960,
    "wires": [
      [
        "43b1f977.027e7"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "341506b4.7712a2",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Entertainment Room Occupancy",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.entertainment_room_occupancy",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 220,
    "y": 960,
    "wires": [
      [
        "2cb2a629.6cce0a"
      ],
      []
    ]
  },
  {
    "id": "57d64f7a.76b78",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1690,
    "y": 960,
    "wires": [
      []
    ]
  },
  {
    "id": "bee90142.4384d",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.entertainment_room_ecobee_switch\",\n        message: (attributes && attributes.friendly_name || \"Occupancy\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1410,
    "y": 960,
    "wires": [
      [
        "57d64f7a.76b78"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "a2f07c32.ddf588",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1190,
    "y": 960,
    "wires": [
      [
        "bee90142.4384d"
      ]
    ]
  },
  {
    "id": "43b1f977.027e7",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 980,
    "y": 960,
    "wires": [
      [
        "a2f07c32.ddf588"
      ]
    ]
  },
  {
    "id": "2755b27d.2c11e6",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 460,
    "y": 1020,
    "wires": [
      [
        "85a0c3c2.5b0ec8"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "85a0c3c2.5b0ec8",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 710,
    "y": 1020,
    "wires": [
      [
        "fc37985f.ca62b8"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "a4b0f2e2.c37088",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Kitchen Occupancy",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.main_floor_occupancy",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 170,
    "y": 1020,
    "wires": [
      [
        "2755b27d.2c11e6"
      ],
      []
    ]
  },
  {
    "id": "40150713.1625e",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1650,
    "y": 1020,
    "wires": [
      []
    ]
  },
  {
    "id": "ca9c699.6d19518",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.kitchen_echo_plus\",\n        message: (attributes && attributes.friendly_name || \"Occupancy\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1370,
    "y": 1020,
    "wires": [
      [
        "40150713.1625e"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "35732650.c3aaba",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1150,
    "y": 1020,
    "wires": [
      [
        "ca9c699.6d19518"
      ]
    ]
  },
  {
    "id": "fc37985f.ca62b8",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 940,
    "y": 1020,
    "wires": [
      [
        "35732650.c3aaba"
      ]
    ]
  },
  {
    "id": "1de23935.1848e7",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 460,
    "y": 1080,
    "wires": [
      [
        "482126df.e0bf6"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "482126df.e0bf6",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 710,
    "y": 1080,
    "wires": [
      [
        "2b489674.dfd7f2"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "2858036.694db7c",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Kitchen Main Lights Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.kitchen_main_lights_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 200,
    "y": 1080,
    "wires": [
      [
        "1de23935.1848e7"
      ],
      []
    ]
  },
  {
    "id": "48c3af69.f1e398",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1650,
    "y": 1080,
    "wires": [
      []
    ]
  },
  {
    "id": "39bdf62f.87f68a",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.kitchen_echo_plus\",\n        message: (attributes && attributes.friendly_name || \"Motion\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1370,
    "y": 1080,
    "wires": [
      [
        "48c3af69.f1e398"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "6dfa5d24.841c84",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1150,
    "y": 1080,
    "wires": [
      [
        "39bdf62f.87f68a"
      ]
    ]
  },
  {
    "id": "2b489674.dfd7f2",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 940,
    "y": 1080,
    "wires": [
      [
        "6dfa5d24.841c84"
      ]
    ]
  },
  {
    "id": "d44e58ab.ed76c8",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 460,
    "y": 1140,
    "wires": [
      [
        "c802596b.d1c92"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "c802596b.d1c92",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 710,
    "y": 1140,
    "wires": [
      [
        "98ecbac7.c8294"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "4eac8bdd.575624",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Kitchen Sink Lights Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.kitchen_sink_lights_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 200,
    "y": 1140,
    "wires": [
      [
        "d44e58ab.ed76c8"
      ],
      []
    ]
  },
  {
    "id": "840b93de.0ee438",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1650,
    "y": 1140,
    "wires": [
      []
    ]
  },
  {
    "id": "651685e9.a6377c",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.kitchen_echo_plus\",\n        message: (attributes && attributes.friendly_name || \"Motion\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1370,
    "y": 1140,
    "wires": [
      [
        "840b93de.0ee438"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "d164dffa.227468",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1150,
    "y": 1140,
    "wires": [
      [
        "651685e9.a6377c"
      ]
    ]
  },
  {
    "id": "98ecbac7.c8294",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 940,
    "y": 1140,
    "wires": [
      [
        "d164dffa.227468"
      ]
    ]
  },
  {
    "id": "5cb7b592.36e67c",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 460,
    "y": 1260,
    "wires": [
      [
        "2faf8804.a7be28"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "2faf8804.a7be28",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 710,
    "y": 1260,
    "wires": [
      [
        "688a00f1.c866d8"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "3ca40c1f.d679bc",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Laundry Room Occupancy",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.laundry_room_occupancy",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 200,
    "y": 1260,
    "wires": [
      [
        "5cb7b592.36e67c"
      ],
      []
    ]
  },
  {
    "id": "5f94ed66.eb629c",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1650,
    "y": 1260,
    "wires": [
      []
    ]
  },
  {
    "id": "1452d48c.b4c3cb",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.laundry_room_ecobee_switch\",\n        message: (attributes && attributes.friendly_name || \"Occupancy\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1370,
    "y": 1260,
    "wires": [
      [
        "5f94ed66.eb629c"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "66b1ec3f.075e34",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1150,
    "y": 1260,
    "wires": [
      [
        "1452d48c.b4c3cb"
      ]
    ]
  },
  {
    "id": "688a00f1.c866d8",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 940,
    "y": 1260,
    "wires": [
      [
        "66b1ec3f.075e34"
      ]
    ]
  },
  {
    "id": "a0fd7688.73d098",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 460,
    "y": 1320,
    "wires": [
      [
        "1e1c7b5a.f777b5"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "1e1c7b5a.f777b5",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 710,
    "y": 1320,
    "wires": [
      [
        "1b61d5b6.40f732"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "7e9eefd6.83bde",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Office Occupancy",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.office_occupancy",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 170,
    "y": 1320,
    "wires": [
      [
        "a0fd7688.73d098"
      ],
      []
    ]
  },
  {
    "id": "c90dd540.200218",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1650,
    "y": 1320,
    "wires": [
      []
    ]
  },
  {
    "id": "df800460.9f9ae8",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.office_ecobee4\",\n        message: (attributes && attributes.friendly_name || \"Occupancy\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1370,
    "y": 1320,
    "wires": [
      [
        "c90dd540.200218"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "b539a8ab.a831e",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1150,
    "y": 1320,
    "wires": [
      [
        "df800460.9f9ae8"
      ]
    ]
  },
  {
    "id": "1b61d5b6.40f732",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 940,
    "y": 1320,
    "wires": [
      [
        "b539a8ab.a831e"
      ]
    ]
  },
  {
    "id": "cf4016c.13dfde8",
    "type": "comment",
    "z": "edd021ae.2eeb9",
    "name": "Second Floor",
    "info": "",
    "x": 150,
    "y": 1380,
    "wires": []
  },
  {
    "id": "d09b88a5.5dfb58",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 420,
    "y": 1480,
    "wires": [
      [
        "9ee93974.a3231"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "9ee93974.a3231",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 670,
    "y": 1480,
    "wires": [
      [
        "e020dab9.bca7c8"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "a6ad5896.1cfb2",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Master Bedroom Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.master_bedroom_closet_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 190,
    "y": 1480,
    "wires": [
      [
        "d09b88a5.5dfb58"
      ],
      []
    ]
  },
  {
    "id": "fdb5e363.b8944",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1610,
    "y": 1480,
    "wires": [
      []
    ]
  },
  {
    "id": "f93d720.c362f9",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.media_player.master_bedroom_echo_plus\",\n        message: (attributes && attributes.friendly_name || \"Motion\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1330,
    "y": 1480,
    "wires": [
      [
        "fdb5e363.b8944"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "69b5ab17.f5c5dc",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1110,
    "y": 1480,
    "wires": [
      [
        "f93d720.c362f9"
      ]
    ]
  },
  {
    "id": "e020dab9.bca7c8",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 900,
    "y": 1480,
    "wires": [
      [
        "69b5ab17.f5c5dc"
      ]
    ]
  },
  {
    "id": "19fe2a9c.789e7d",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 460,
    "y": 1540,
    "wires": [
      [
        "fc42a147.344578"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "fc42a147.344578",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 710,
    "y": 1540,
    "wires": [
      [
        "f086f97e.92c668"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "1cc5e8e2.601e9f",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Master Bedroom Occupancy",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.upstairs_occupancy",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 200,
    "y": 1540,
    "wires": [
      [
        "19fe2a9c.789e7d"
      ],
      []
    ]
  },
  {
    "id": "42ebda79.071de4",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1650,
    "y": 1540,
    "wires": [
      []
    ]
  },
  {
    "id": "46f117a6.82b14",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.media_player.master_bedroom_echo_plus\",\n        message: (attributes && attributes.friendly_name || \"Occupancy\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1370,
    "y": 1540,
    "wires": [
      [
        "42ebda79.071de4"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "ae57f4d4.3f6878",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1150,
    "y": 1540,
    "wires": [
      [
        "46f117a6.82b14"
      ]
    ]
  },
  {
    "id": "f086f97e.92c668",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 940,
    "y": 1540,
    "wires": [
      [
        "ae57f4d4.3f6878"
      ]
    ]
  },
  {
    "id": "a081ec90.4f7e28",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 460,
    "y": 1600,
    "wires": [
      [
        "3bc9bd9f.9b60da"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "3bc9bd9f.9b60da",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 710,
    "y": 1600,
    "wires": [
      [
        "11f27dca.e358a2"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "7c8b6495.917ddc",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Kids 1 Bedroom Occupancy",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.kids_room_one_occupancy",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 200,
    "y": 1600,
    "wires": [
      [
        "a081ec90.4f7e28"
      ],
      []
    ]
  },
  {
    "id": "6f7c068e.778298",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1650,
    "y": 1600,
    "wires": [
      []
    ]
  },
  {
    "id": "c76b8b4b.27a858",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.media_player.kids_bedroom_one_ecobee_switch\",\n        message: (attributes && attributes.friendly_name || \"Occupancy\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1370,
    "y": 1600,
    "wires": [
      [
        "6f7c068e.778298"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "80861f97.e31548",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1150,
    "y": 1600,
    "wires": [
      [
        "c76b8b4b.27a858"
      ]
    ]
  },
  {
    "id": "11f27dca.e358a2",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 940,
    "y": 1600,
    "wires": [
      [
        "80861f97.e31548"
      ]
    ]
  },
  {
    "id": "790e42ca.14eedc",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 460,
    "y": 1660,
    "wires": [
      [
        "fa6e4096.d4f09"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "fa6e4096.d4f09",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 710,
    "y": 1660,
    "wires": [
      [
        "160b9c43.e5f204"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "1cf35ed4.28abb1",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Kids 2 Bedroom Occupancy",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.kids_room_two_occupancy",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 200,
    "y": 1660,
    "wires": [
      [
        "790e42ca.14eedc"
      ],
      []
    ]
  },
  {
    "id": "5f6c65e6.e2ee94",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1650,
    "y": 1660,
    "wires": [
      []
    ]
  },
  {
    "id": "f29180c7.477a28",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.media_player.kids_bedroom_two_ecobee_switch\",\n        message: (attributes && attributes.friendly_name || \"Occupancy\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1370,
    "y": 1660,
    "wires": [
      [
        "5f6c65e6.e2ee94"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "a105c317.93fc8",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1150,
    "y": 1660,
    "wires": [
      [
        "f29180c7.477a28"
      ]
    ]
  },
  {
    "id": "160b9c43.e5f204",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 940,
    "y": 1660,
    "wires": [
      [
        "a105c317.93fc8"
      ]
    ]
  },
  {
    "id": "73ebd31a.3037c4",
    "type": "comment",
    "z": "19c1cd7b.5d8c23",
    "name": "First Floor",
    "info": "",
    "x": 100,
    "y": 600,
    "wires": []
  },
  {
    "id": "6820d119.0e2dc8",
    "type": "function",
    "z": "74bc2936.720808",
    "name": "Configure Sensor State",
    "func": "return { \n    payload: {\n        entity_id: flow.get(\"sensor_entity_id\")\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1170,
    "y": 480,
    "wires": [
      [
        "dcb10681.ede4e"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "933bdf32.03c28",
    "type": "stoptimer",
    "z": "74bc2936.720808",
    "duration": "15",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "Pause Detection for 15 minutes",
    "x": 890,
    "y": 480,
    "wires": [
      [
        "6820d119.0e2dc8"
      ],
      []
    ]
  },
  {
    "id": "dcb10681.ede4e",
    "type": "api-current-state",
    "z": "74bc2936.720808",
    "name": "Motion Detected?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1410,
    "y": 480,
    "wires": [
      [
        "23f6434a.4c111c"
      ]
    ]
  },
  {
    "id": "ecc4dd8f.7689e8",
    "type": "switch",
    "z": "74bc2936.720808",
    "name": "on",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 590,
    "y": 480,
    "wires": [
      [
        "933bdf32.03c28"
      ]
    ]
  },
  {
    "id": "23f6434a.4c111c",
    "type": "switch",
    "z": "74bc2936.720808",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1590,
    "y": 480,
    "wires": [
      [
        "ce00940c.5b213"
      ],
      [
        "82cc6037.4a8ab"
      ]
    ],
    "outputLabels": [
      "On",
      "Off"
    ]
  },
  {
    "id": "604ae411.82dfac",
    "type": "state-machine",
    "z": "74bc2936.720808",
    "name": "State Machine",
    "triggerProperty": "payload",
    "triggerPropertyType": "msg",
    "stateProperty": "payload",
    "statePropertyType": "msg",
    "outputStateChangeOnly": true,
    "throwException": false,
    "states": [
      "default",
      "switch",
      "motion-detected",
      "motion-on",
      "motion-off",
      "off",
      "on"
    ],
    "transitions": [
      {
        "name": "motion",
        "from": "off",
        "to": "motion-detected"
      },
      {
        "name": "motion",
        "from": "motion-on",
        "to": "motion-on"
      },
      {
        "name": "off",
        "from": "*",
        "to": "off"
      },
      {
        "name": "on",
        "from": "*",
        "to": "on"
      },
      {
        "name": "switch",
        "from": "off",
        "to": "switch"
      },
      {
        "name": "switch",
        "from": "on",
        "to": "switch"
      },
      {
        "name": "switch",
        "from": "switch",
        "to": "switch"
      },
      {
        "name": "switch",
        "from": "motion-on",
        "to": "switch"
      },
      {
        "name": "motion-on",
        "from": "motion-detected",
        "to": "motion-on"
      },
      {
        "name": "motion-off",
        "from": "motion-on",
        "to": "motion-off"
      },
      {
        "name": "motion-off",
        "from": "on",
        "to": "motion-off"
      },
      {
        "name": "motion-detected",
        "from": "default",
        "to": "motion-detected"
      }
    ],
    "x": 380,
    "y": 180,
    "wires": [
      [
        "ecc4dd8f.7689e8",
        "b02e9c30.446088",
        "1a4d8c61.3c7abc",
        "3911cf20.cc817",
        "7380f955.4f3628",
        "1974c8aa.d00197",
        "feb6af5a.1d3ec8"
      ]
    ]
  },
  {
    "id": "82cc6037.4a8ab",
    "type": "change",
    "z": "74bc2936.720808",
    "name": "motion-off",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion-off",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1930,
    "y": 300,
    "wires": [
      [
        "38c3670a.6fa2e"
      ]
    ]
  },
  {
    "id": "ce00940c.5b213",
    "type": "function",
    "z": "74bc2936.720808",
    "name": "Configure Switch State",
    "func": "return { \n    payload: {\n        entity_id: flow.get(\"switch_entity_id\")\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1710,
    "y": 240,
    "wires": [
      [
        "4332d6c7.4837e"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "50bb0f9e.e87c8",
    "type": "link in",
    "z": "74bc2936.720808",
    "name": "Motion State Machine",
    "links": [
      "38c3670a.6fa2e"
    ],
    "x": 315,
    "y": 100,
    "wires": [
      [
        "604ae411.82dfac",
        "b63a2a21.232ec"
      ]
    ]
  },
  {
    "id": "b02e9c30.446088",
    "type": "switch",
    "z": "74bc2936.720808",
    "name": "motion-detected",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "motion-detected",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 630,
    "y": 180,
    "wires": [
      [
        "f1dec1ab.1782f8"
      ]
    ]
  },
  {
    "id": "1a4d8c61.3c7abc",
    "type": "switch",
    "z": "74bc2936.720808",
    "name": "motion-on",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "motion-on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 610,
    "y": 300,
    "wires": [
      [
        "3c695fca.1ed568"
      ]
    ]
  },
  {
    "id": "3911cf20.cc817",
    "type": "switch",
    "z": "74bc2936.720808",
    "name": "switch",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "switch",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 590,
    "y": 360,
    "wires": [
      [
        "f7ee3349.a44948",
        "3a7be70.877691a"
      ]
    ]
  },
  {
    "id": "7380f955.4f3628",
    "type": "switch",
    "z": "74bc2936.720808",
    "name": "motion-off",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "motion-off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 610,
    "y": 240,
    "wires": [
      [
        "266232e7.87e78e"
      ]
    ]
  },
  {
    "id": "1974c8aa.d00197",
    "type": "switch",
    "z": "74bc2936.720808",
    "name": "default",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "default",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 590,
    "y": 540,
    "wires": [
      [
        "38621117.396626"
      ]
    ]
  },
  {
    "id": "b5d20027.5ce2d",
    "type": "function",
    "z": "74bc2936.720808",
    "name": "Set Flow State",
    "func": "if (!msg.payload) {\n    return \"default\";\n}\n\nconst sensor_entity_id = msg.payload.sensor_entity_id;\nconst switch_entity_id = msg.payload.switch_entity_id;\nconst speech_entity_id = msg.payload.speech_entity_id || \"media_player.office_echo_plus\";\n\nflow.set(\"sensor_entity_id\", sensor_entity_id);\nflow.set(\"switch_entity_id\", switch_entity_id);\nflow.set(\"speech_entity_id\", speech_entity_id);\n\nnode.log(\"Incoming state: \" + msg.payload.state);\nnode.status({ fill: \"green\", shape: \"dot\", text: msg.payload.state });\nreturn { payload: msg.payload.state || \"default\" };",
    "outputs": 1,
    "noerr": 0,
    "x": 180,
    "y": 180,
    "wires": [
      [
        "604ae411.82dfac"
      ]
    ]
  },
  {
    "id": "38c3670a.6fa2e",
    "type": "link out",
    "z": "74bc2936.720808",
    "name": "Motion State Machine",
    "links": [
      "50bb0f9e.e87c8"
    ],
    "x": 2095,
    "y": 100,
    "wires": []
  },
  {
    "id": "3c695fca.1ed568",
    "type": "stoptimer",
    "z": "74bc2936.720808",
    "duration": "5",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "5 Minute Delay",
    "x": 1060,
    "y": 300,
    "wires": [
      [
        "82cc6037.4a8ab"
      ],
      []
    ]
  },
  {
    "id": "6be5e79c.2161e",
    "type": "stoptimer",
    "z": "74bc2936.720808",
    "duration": "10",
    "units": "Second",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "10 Second Delay",
    "x": 1410,
    "y": 240,
    "wires": [
      [
        "ce00940c.5b213"
      ],
      []
    ]
  },
  {
    "id": "4332d6c7.4837e",
    "type": "api-current-state",
    "z": "74bc2936.720808",
    "name": "Switch State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1930,
    "y": 240,
    "wires": [
      [
        "38c3670a.6fa2e"
      ]
    ]
  },
  {
    "id": "3a7be70.877691a",
    "type": "stoptimer",
    "z": "74bc2936.720808",
    "duration": "5",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "Pause Detection for 5 minutes",
    "x": 890,
    "y": 420,
    "wires": [
      [
        "ce00940c.5b213"
      ],
      []
    ]
  },
  {
    "id": "2d40026.f9636fe",
    "type": "switch",
    "z": "74bc2936.720808",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1590,
    "y": 540,
    "wires": [
      [
        "46268df3.19095c"
      ],
      [
        "ce00940c.5b213"
      ]
    ],
    "outputLabels": [
      "On",
      "Off"
    ]
  },
  {
    "id": "9086ae0b.0843c",
    "type": "inject",
    "z": "74bc2936.720808",
    "name": "steady-state",
    "topic": "",
    "payload": "stop",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 1170,
    "y": 420,
    "wires": [
      [
        "ce00940c.5b213",
        "3a7be70.877691a"
      ]
    ]
  },
  {
    "id": "f1dec1ab.1782f8",
    "type": "function",
    "z": "74bc2936.720808",
    "name": "Configure Switch",
    "func": "return { \n    payload: {\n        speech_entity_id: flow.get(\"speech_entity_id\"),\n        entity_id: flow.get(\"switch_entity_id\"),\n        state: \"on\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 850,
    "y": 180,
    "wires": [
      [
        "1353ffe2.fdd63"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "f7ee3349.a44948",
    "type": "change",
    "z": "74bc2936.720808",
    "name": "stop",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "stop",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 810,
    "y": 360,
    "wires": [
      [
        "3c695fca.1ed568"
      ]
    ]
  },
  {
    "id": "266232e7.87e78e",
    "type": "function",
    "z": "74bc2936.720808",
    "name": "Configure Switch",
    "func": "return { \n    payload: {\n        speech_entity_id: flow.get(\"speech_entity_id\"),\n        entity_id: flow.get(\"switch_entity_id\"),\n        state: \"off\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 850,
    "y": 240,
    "wires": [
      [
        "723f1568.92e234"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "fefcb093.ce5008",
    "type": "change",
    "z": "74bc2936.720808",
    "name": "motion-on",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion-on",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1930,
    "y": 180,
    "wires": [
      [
        "38c3670a.6fa2e"
      ]
    ]
  },
  {
    "id": "46268df3.19095c",
    "type": "change",
    "z": "74bc2936.720808",
    "name": "motion-detected",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion-detected",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1950,
    "y": 360,
    "wires": [
      [
        "38c3670a.6fa2e"
      ]
    ]
  },
  {
    "id": "723f1568.92e234",
    "type": "subflow:af0c5464.36789",
    "z": "74bc2936.720808",
    "name": "",
    "x": 1130,
    "y": 240,
    "wires": [
      [
        "6be5e79c.2161e"
      ]
    ]
  },
  {
    "id": "1353ffe2.fdd63",
    "type": "subflow:af0c5464.36789",
    "z": "74bc2936.720808",
    "name": "",
    "env": [],
    "x": 1130,
    "y": 180,
    "wires": [
      [
        "47022e5.b63e6d"
      ]
    ]
  },
  {
    "id": "47022e5.b63e6d",
    "type": "stoptimer",
    "z": "74bc2936.720808",
    "duration": "10",
    "units": "Second",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "10 Second Delay",
    "x": 1410,
    "y": 180,
    "wires": [
      [
        "fefcb093.ce5008"
      ],
      []
    ]
  },
  {
    "id": "38621117.396626",
    "type": "function",
    "z": "74bc2936.720808",
    "name": "Configure Sensor State",
    "func": "return { \n    payload: {\n        entity_id: flow.get(\"sensor_entity_id\")\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 870,
    "y": 540,
    "wires": [
      [
        "463da840.eea93"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "463da840.eea93",
    "type": "api-current-state",
    "z": "74bc2936.720808",
    "name": "Motion Detected?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 1110,
    "y": 540,
    "wires": [
      [
        "2d40026.f9636fe",
        "f1f96e61.f07d7"
      ]
    ]
  },
  {
    "id": "fddd3a19.06a2c8",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 380,
    "y": 740,
    "wires": [
      [
        "a072b18d.2e862"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "a072b18d.2e862",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 660,
    "y": 740,
    "wires": [
      [
        "e0c41be.9f8c868"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "380998fe.122838",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Back Hallway Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.back_hallway_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 140,
    "y": 740,
    "wires": [
      [
        "fddd3a19.06a2c8"
      ],
      []
    ]
  },
  {
    "id": "aa10cb7c.1b2338",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 580,
    "y": 820,
    "wires": [
      [
        "f211a4ad.b5c32"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "f211a4ad.b5c32",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 860,
    "y": 820,
    "wires": [
      [
        "f9ba5750.c2d0f"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "5e8e8438.d77ad4",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Back Hallway Motion Switch",
    "server": "61956bd4.93df44",
    "entityid": "switch.back_hallway_motion_switch",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 320,
    "y": 820,
    "wires": [
      [
        "aa10cb7c.1b2338"
      ],
      []
    ]
  },
  {
    "id": "e0c41be.9f8c868",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Dark Outside?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "7500",
    "halt_if_type": "num",
    "halt_if_compare": "gte",
    "override_topic": false,
    "entity_id": "sensor.illuminance",
    "state_type": "num",
    "state_location": "",
    "override_payload": "none",
    "entity_location": "",
    "override_data": "none",
    "x": 920,
    "y": 740,
    "wires": [
      [
        "5ecdb70f.ccdc48"
      ],
      []
    ]
  },
  {
    "id": "f9ba5750.c2d0f",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "switch",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "switch",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "binary_sensor.back_hallway_motion_switch_motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1090,
    "y": 820,
    "wires": [
      [
        "2d362305.29947c"
      ]
    ]
  },
  {
    "id": "5ecdb70f.ccdc48",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "motion",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1090,
    "y": 740,
    "wires": [
      [
        "2d362305.29947c"
      ]
    ]
  },
  {
    "id": "fec5de7a.a14d7",
    "type": "inject",
    "z": "19c1cd7b.5d8c23",
    "name": "Trigger Motion",
    "topic": "binary_sensor.back_hallway_motion_switch_motion",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 950,
    "y": 680,
    "wires": [
      [
        "5ecdb70f.ccdc48"
      ]
    ]
  },
  {
    "id": "2d362305.29947c",
    "type": "function",
    "z": "19c1cd7b.5d8c23",
    "name": "Set State",
    "func": "return { \n    payload: {\n        sensor_entity_id: msg.topic,\n        switch_entity_id: \"switch.back_hallway_motion_switch\",\n        speech_entity_id: \"media_player.back_foyer_ecobee_switch\",\n        state: msg.payload || \"default\"\n    }\n}",
    "outputs": 1,
    "noerr": 0,
    "x": 1240,
    "y": 780,
    "wires": [
      [
        "1ca678f4.af26df"
      ]
    ]
  },
  {
    "id": "1ca678f4.af26df",
    "type": "subflow:74bc2936.720808",
    "z": "19c1cd7b.5d8c23",
    "name": "",
    "env": [],
    "x": 1420,
    "y": 780,
    "wires": []
  },
  {
    "id": "e6c7b930.d60128",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 380,
    "y": 940,
    "wires": [
      [
        "7a94b53.885d84c"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "7a94b53.885d84c",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 660,
    "y": 940,
    "wires": [
      [
        "85180ae3.937628"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "b850210a.5afd48",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Back Hallway Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.back_hallway_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 140,
    "y": 940,
    "wires": [
      [
        "e6c7b930.d60128"
      ],
      []
    ]
  },
  {
    "id": "f7d957b3.3b93c8",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 580,
    "y": 1020,
    "wires": [
      [
        "c9223860.8bc6a"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "c9223860.8bc6a",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 860,
    "y": 1020,
    "wires": [
      [
        "80ecf9c9.7a97e"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "f93881ea.60e768",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Back Hallway Bathroom Switch",
    "server": "61956bd4.93df44",
    "entityid": "switch.back_hallway_bathroom_switch",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 310,
    "y": 1020,
    "wires": [
      [
        "f7d957b3.3b93c8"
      ],
      []
    ]
  },
  {
    "id": "85180ae3.937628",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Dark Outside?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "7500",
    "halt_if_type": "num",
    "halt_if_compare": "gte",
    "override_topic": false,
    "entity_id": "sensor.illuminance",
    "state_type": "num",
    "state_location": "",
    "override_payload": "none",
    "entity_location": "",
    "override_data": "none",
    "x": 920,
    "y": 940,
    "wires": [
      [
        "8e67c6ac.f1b28"
      ],
      []
    ]
  },
  {
    "id": "80ecf9c9.7a97e",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "switch",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "switch",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "binary_sensor.back_hallway_motion_switch_motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1090,
    "y": 1020,
    "wires": [
      [
        "2bad615c.ec8146"
      ]
    ]
  },
  {
    "id": "8e67c6ac.f1b28",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "motion",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1090,
    "y": 940,
    "wires": [
      [
        "2bad615c.ec8146"
      ]
    ]
  },
  {
    "id": "fd5c905.6ed037",
    "type": "inject",
    "z": "19c1cd7b.5d8c23",
    "name": "Trigger Motion",
    "topic": "binary_sensor.back_hallway_motion_switch_motion",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 930,
    "y": 880,
    "wires": [
      [
        "8e67c6ac.f1b28"
      ]
    ]
  },
  {
    "id": "2bad615c.ec8146",
    "type": "function",
    "z": "19c1cd7b.5d8c23",
    "name": "Set State",
    "func": "return { \n    payload: {\n        sensor_entity_id: msg.topic,\n        switch_entity_id: \"switch.back_hallway_bathroom_switch\",\n        speech_entity_id: \"media_player.back_foyer_ecobee_switch\",\n        state: msg.payload || \"default\"\n    }\n}",
    "outputs": 1,
    "noerr": 0,
    "x": 1240,
    "y": 980,
    "wires": [
      [
        "a2e89311.44e908"
      ]
    ]
  },
  {
    "id": "a2e89311.44e908",
    "type": "subflow:74bc2936.720808",
    "z": "19c1cd7b.5d8c23",
    "name": "",
    "env": [],
    "x": 1420,
    "y": 980,
    "wires": []
  },
  {
    "id": "5e3ed9a2.ecacb",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 420,
    "y": 1140,
    "wires": [
      [
        "8f1e7b1c.8a612"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "8f1e7b1c.8a612",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 700,
    "y": 1140,
    "wires": [
      [
        "58d218ad.d40578"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "f21a251b.5e4bc",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Kitchen Main Lights Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.kitchen_main_lights_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 160,
    "y": 1140,
    "wires": [
      [
        "5e3ed9a2.ecacb"
      ],
      []
    ]
  },
  {
    "id": "5bf7204e.6f65c",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 620,
    "y": 1220,
    "wires": [
      [
        "95a68a67.0e7bf8"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "95a68a67.0e7bf8",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 900,
    "y": 1220,
    "wires": [
      [
        "f702382a.5f67c"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "5af7b7f0.fcd3f8",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Kitchen Main Lights Switch",
    "server": "61956bd4.93df44",
    "entityid": "switch.kitchen_main_lights_motion_switch",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 360,
    "y": 1220,
    "wires": [
      [
        "5bf7204e.6f65c"
      ],
      []
    ]
  },
  {
    "id": "58d218ad.d40578",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Dark Outside?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "7500",
    "halt_if_type": "num",
    "halt_if_compare": "gte",
    "override_topic": false,
    "entity_id": "sensor.illuminance",
    "state_type": "num",
    "state_location": "",
    "override_payload": "none",
    "entity_location": "",
    "override_data": "none",
    "x": 960,
    "y": 1140,
    "wires": [
      [
        "472bfa2f.e0eaac"
      ],
      []
    ]
  },
  {
    "id": "f702382a.5f67c",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "switch",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "switch",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "binary_sensor.kitchen_main_lights_motion_switch_motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1130,
    "y": 1220,
    "wires": [
      [
        "e58a05f7.355c3"
      ]
    ]
  },
  {
    "id": "472bfa2f.e0eaac",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "motion",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1130,
    "y": 1140,
    "wires": [
      [
        "e58a05f7.355c3"
      ]
    ]
  },
  {
    "id": "46d534cd.b76b54",
    "type": "inject",
    "z": "19c1cd7b.5d8c23",
    "name": "Trigger Motion",
    "topic": "binary_sensor.kitchen_main_lights_motion_switch_motion",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 970,
    "y": 1080,
    "wires": [
      [
        "472bfa2f.e0eaac"
      ]
    ]
  },
  {
    "id": "e58a05f7.355c3",
    "type": "function",
    "z": "19c1cd7b.5d8c23",
    "name": "Set State",
    "func": "return { \n    payload: {\n        sensor_entity_id: msg.topic,\n        switch_entity_id: \"switch.kitchen_main_lights_motion_switch\",\n        speech_entity_id: \"media_player.kitchen_echo_plus\",\n        state: msg.payload || \"default\"\n    }\n}",
    "outputs": 1,
    "noerr": 0,
    "x": 1280,
    "y": 1180,
    "wires": [
      [
        "48c86d49.27652c"
      ]
    ]
  },
  {
    "id": "48c86d49.27652c",
    "type": "subflow:74bc2936.720808",
    "z": "19c1cd7b.5d8c23",
    "name": "",
    "env": [],
    "x": 1460,
    "y": 1180,
    "wires": []
  },
  {
    "id": "51674ca3.909cf4",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 380,
    "y": 2020,
    "wires": [
      [
        "ec41e5db.18fc3"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "ec41e5db.18fc3",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 660,
    "y": 2020,
    "wires": [
      [
        "30398eb0.8d7312"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "ccaf47ad.2e6438",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Upstairs Hallway Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.upstairs_hallway_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 150,
    "y": 2020,
    "wires": [
      [
        "51674ca3.909cf4"
      ],
      []
    ]
  },
  {
    "id": "d811bfa7.7a7aa",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 580,
    "y": 2100,
    "wires": [
      [
        "fdfe1fdf.2c40b8"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "fdfe1fdf.2c40b8",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 860,
    "y": 2100,
    "wires": [
      [
        "e7a16521.c1568"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "1fcc6789.f76a9",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Upstairs Hallway Switch",
    "server": "61956bd4.93df44",
    "entityid": "switch.upstairs_hallway_motion_switch",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 330,
    "y": 2100,
    "wires": [
      [
        "d811bfa7.7a7aa"
      ],
      []
    ]
  },
  {
    "id": "30398eb0.8d7312",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Dark Outside?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "7500",
    "halt_if_type": "num",
    "halt_if_compare": "gte",
    "override_topic": false,
    "entity_id": "sensor.illuminance",
    "state_type": "num",
    "state_location": "",
    "override_payload": "none",
    "entity_location": "",
    "override_data": "none",
    "x": 920,
    "y": 2020,
    "wires": [
      [
        "e03dcff.9e8e53"
      ],
      []
    ]
  },
  {
    "id": "e7a16521.c1568",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "switch",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "switch",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "binary_sensor.upstairs_hallway_motion_switch_motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1090,
    "y": 2100,
    "wires": [
      [
        "db79f1ce.f5d13"
      ]
    ]
  },
  {
    "id": "e03dcff.9e8e53",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "motion",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1090,
    "y": 2020,
    "wires": [
      [
        "db79f1ce.f5d13"
      ]
    ]
  },
  {
    "id": "d45a7acb.99b3d8",
    "type": "inject",
    "z": "19c1cd7b.5d8c23",
    "name": "Trigger Motion",
    "topic": "binary_sensor.upstairs_hallway_motion_switch_motion",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 930,
    "y": 1960,
    "wires": [
      [
        "e03dcff.9e8e53"
      ]
    ]
  },
  {
    "id": "db79f1ce.f5d13",
    "type": "function",
    "z": "19c1cd7b.5d8c23",
    "name": "Set State",
    "func": "return { \n    payload: {\n        sensor_entity_id: msg.topic,\n        switch_entity_id: \"switch.upstairs_hallway_motion_switch\",\n        speech_entity_id: \"media_player.kids_bathroom_ecobee_switch\",\n        state: msg.payload || \"default\"\n    }\n}",
    "outputs": 1,
    "noerr": 0,
    "x": 1240,
    "y": 2060,
    "wires": [
      [
        "72d17733.87c9d8"
      ]
    ]
  },
  {
    "id": "72d17733.87c9d8",
    "type": "subflow:74bc2936.720808",
    "z": "19c1cd7b.5d8c23",
    "name": "",
    "x": 1420,
    "y": 2060,
    "wires": []
  },
  {
    "id": "9666e762.04bb1",
    "type": "comment",
    "z": "19c1cd7b.5d8c23",
    "name": "Upstairs",
    "info": "",
    "x": 100,
    "y": 1960,
    "wires": []
  },
  {
    "id": "1788ba35.539b06",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 420,
    "y": 1540,
    "wires": [
      [
        "5c65165a.533b08"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "5c65165a.533b08",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 700,
    "y": 1540,
    "wires": [
      [
        "2576041d.741bac"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "6fca45b9.58441c",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Kitchen Sink Lights Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.kitchen_sink_lights_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 160,
    "y": 1540,
    "wires": [
      [
        "1788ba35.539b06"
      ],
      []
    ]
  },
  {
    "id": "449c1d79.0dc19c",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 620,
    "y": 1620,
    "wires": [
      [
        "ad813c07.a24bf8"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "ad813c07.a24bf8",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 900,
    "y": 1620,
    "wires": [
      [
        "ea13ef7d.cc315"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "10255231.456ede",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Kitchen Sink Lights Switch",
    "server": "61956bd4.93df44",
    "entityid": "light.kitchen_sink_lights_motion_dimmer_level",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 360,
    "y": 1620,
    "wires": [
      [
        "449c1d79.0dc19c"
      ],
      []
    ]
  },
  {
    "id": "2576041d.741bac",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Dark Outside?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "7500",
    "halt_if_type": "num",
    "halt_if_compare": "gte",
    "override_topic": false,
    "entity_id": "sensor.illuminance",
    "state_type": "num",
    "state_location": "",
    "override_payload": "none",
    "entity_location": "",
    "override_data": "none",
    "x": 960,
    "y": 1540,
    "wires": [
      [
        "18d26457.fc85d4"
      ],
      []
    ]
  },
  {
    "id": "ea13ef7d.cc315",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "switch",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "switch",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "binary_sensor.kitchen_sink_lights_motion_switch_motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1130,
    "y": 1620,
    "wires": [
      [
        "db5d4f72.871178"
      ]
    ]
  },
  {
    "id": "18d26457.fc85d4",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "motion",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1130,
    "y": 1540,
    "wires": [
      [
        "db5d4f72.871178"
      ]
    ]
  },
  {
    "id": "53f0bcc0.3b73ac",
    "type": "inject",
    "z": "19c1cd7b.5d8c23",
    "name": "Trigger Motion",
    "topic": "binary_sensor.kitchen_sink_lights_motion_switch_motion",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 970,
    "y": 1480,
    "wires": [
      [
        "18d26457.fc85d4"
      ]
    ]
  },
  {
    "id": "db5d4f72.871178",
    "type": "function",
    "z": "19c1cd7b.5d8c23",
    "name": "Set State",
    "func": "return { \n    payload: {\n        sensor_entity_id: msg.topic,\n        light_entity_id: \"light.kitchen_sink_lights_motion_dimmer_level\",\n        speech_entity_id: \"media_player.kitchen_echo_plus\",\n        state: msg.payload || \"default\"\n    }\n}",
    "outputs": 1,
    "noerr": 0,
    "x": 1280,
    "y": 1580,
    "wires": [
      [
        "356e25a2.ddaa2a"
      ]
    ]
  },
  {
    "id": "447a356f.3f5e44",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 420,
    "y": 1340,
    "wires": [
      [
        "c279617.d86542"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "c279617.d86542",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 700,
    "y": 1340,
    "wires": [
      [
        "b94070d.199451"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "3255f6b4.0f6e72",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Kitchen Main Lights Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.kitchen_main_lights_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 160,
    "y": 1340,
    "wires": [
      [
        "447a356f.3f5e44"
      ],
      []
    ]
  },
  {
    "id": "934791f0.ab37",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 620,
    "y": 1420,
    "wires": [
      [
        "9cdb92c3.7f3d8"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "9cdb92c3.7f3d8",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 900,
    "y": 1420,
    "wires": [
      [
        "e92ac5bd.3dcdb"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "10c52c1e.c052ec",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Kitchen Bar Lights Switch",
    "server": "61956bd4.93df44",
    "entityid": "switch.kitchen_bar_lights_switch",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 350,
    "y": 1420,
    "wires": [
      [
        "934791f0.ab37"
      ],
      []
    ]
  },
  {
    "id": "b94070d.199451",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Dark Outside?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "7500",
    "halt_if_type": "num",
    "halt_if_compare": "gte",
    "override_topic": false,
    "entity_id": "sensor.illuminance",
    "state_type": "num",
    "state_location": "",
    "override_payload": "none",
    "entity_location": "",
    "override_data": "none",
    "x": 960,
    "y": 1340,
    "wires": [
      [
        "53c8a3b8.cbca14"
      ],
      []
    ]
  },
  {
    "id": "e92ac5bd.3dcdb",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "switch",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "switch",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "binary_sensor.kitchen_main_lights_motion_switch_motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1130,
    "y": 1420,
    "wires": [
      [
        "52e1a09e.d99d28"
      ]
    ]
  },
  {
    "id": "53c8a3b8.cbca14",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "motion",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1130,
    "y": 1340,
    "wires": [
      [
        "52e1a09e.d99d28"
      ]
    ]
  },
  {
    "id": "81904e2e.e16188",
    "type": "inject",
    "z": "19c1cd7b.5d8c23",
    "name": "Trigger Motion",
    "topic": "binary_sensor.kitchen_main_lights_motion_switch_motion",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 970,
    "y": 1280,
    "wires": [
      [
        "53c8a3b8.cbca14"
      ]
    ]
  },
  {
    "id": "52e1a09e.d99d28",
    "type": "function",
    "z": "19c1cd7b.5d8c23",
    "name": "Set State",
    "func": "return { \n    payload: {\n        sensor_entity_id: msg.topic,\n        switch_entity_id: \"switch.kitchen_bar_lights_switch\",\n        speech_entity_id: \"media_player.kitchen_echo_plus\",\n        state: msg.payload || \"default\"\n    }\n}",
    "outputs": 1,
    "noerr": 0,
    "x": 1280,
    "y": 1380,
    "wires": [
      [
        "9721dbaa.ce656"
      ]
    ]
  },
  {
    "id": "9721dbaa.ce656",
    "type": "subflow:74bc2936.720808",
    "z": "19c1cd7b.5d8c23",
    "name": "",
    "x": 1460,
    "y": 1380,
    "wires": []
  },
  {
    "id": "8cc6e048.cc6a2",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 420,
    "y": 1740,
    "wires": [
      [
        "6f190d11.8bb90c"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "6f190d11.8bb90c",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 700,
    "y": 1740,
    "wires": [
      [
        "1c8828ba.069aff"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "c5e66441.c22168",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Kitchen Bar Lights Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.kitchen_main_lights_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 150,
    "y": 1740,
    "wires": [
      [
        "8cc6e048.cc6a2"
      ],
      []
    ]
  },
  {
    "id": "dba5986d.921d6",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 620,
    "y": 1820,
    "wires": [
      [
        "77c57c60.96e734"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "77c57c60.96e734",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 900,
    "y": 1820,
    "wires": [
      [
        "37d573a7.3befd4"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "c54fcfde.b36148",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Kitchen Bar Lights Switch",
    "server": "61956bd4.93df44",
    "entityid": "switch.kitchen_bar_lights_switch",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 350,
    "y": 1820,
    "wires": [
      [
        "dba5986d.921d6"
      ],
      []
    ]
  },
  {
    "id": "1c8828ba.069aff",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Dark Outside?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "7500",
    "halt_if_type": "num",
    "halt_if_compare": "gte",
    "override_topic": false,
    "entity_id": "sensor.illuminance",
    "state_type": "num",
    "state_location": "",
    "override_payload": "none",
    "entity_location": "",
    "override_data": "none",
    "x": 960,
    "y": 1740,
    "wires": [
      [
        "ef33ecea.07d568"
      ],
      []
    ]
  },
  {
    "id": "37d573a7.3befd4",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "switch",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "switch",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "binary_sensor.kitchen_main_lights_motion_switch_motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1130,
    "y": 1820,
    "wires": [
      [
        "49accfde.261db8"
      ]
    ]
  },
  {
    "id": "ef33ecea.07d568",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "motion",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1130,
    "y": 1740,
    "wires": [
      [
        "49accfde.261db8"
      ]
    ]
  },
  {
    "id": "85adbdd4.5998c",
    "type": "inject",
    "z": "19c1cd7b.5d8c23",
    "name": "Trigger Motion",
    "topic": "binary_sensor.kitchen_main_lights_motion_switch_motion",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 970,
    "y": 1680,
    "wires": [
      [
        "ef33ecea.07d568"
      ]
    ]
  },
  {
    "id": "49accfde.261db8",
    "type": "function",
    "z": "19c1cd7b.5d8c23",
    "name": "Set State",
    "func": "return { \n    payload: {\n        sensor_entity_id: msg.topic,\n        switch_entity_id: \"switch.kitchen_bar_lights_switch\",\n        speech_entity_id: \"media_player.kitchen_echo_plus\",\n        state: msg.payload || \"default\"\n    }\n}",
    "outputs": 1,
    "noerr": 0,
    "x": 1280,
    "y": 1780,
    "wires": [
      [
        "7f12d2f5.b4ed3c"
      ]
    ]
  },
  {
    "id": "7f12d2f5.b4ed3c",
    "type": "subflow:74bc2936.720808",
    "z": "19c1cd7b.5d8c23",
    "name": "",
    "x": 1460,
    "y": 1780,
    "wires": []
  },
  {
    "id": "c866f09a.65e288",
    "type": "comment",
    "z": "74bc2936.720808",
    "name": "Check to see if state requires light detection, check motion in last 1 minute before turning off",
    "info": "If requires light detection, turn on or off based on light level.",
    "x": 340,
    "y": 40,
    "wires": []
  },
  {
    "id": "55910bac.1cd284",
    "type": "function",
    "z": "e1915b16.64af68",
    "name": "Configure Sensor State",
    "func": "return { \n    payload: {\n        entity_id: flow.get(\"sensor_entity_id\")\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1190,
    "y": 480,
    "wires": [
      [
        "b3b968b0.718bc8"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "be3ab47f.7161e8",
    "type": "stoptimer",
    "z": "e1915b16.64af68",
    "duration": "15",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "Pause Detection for 15 minutes",
    "x": 910,
    "y": 480,
    "wires": [
      [
        "55910bac.1cd284"
      ],
      []
    ]
  },
  {
    "id": "b3b968b0.718bc8",
    "type": "api-current-state",
    "z": "e1915b16.64af68",
    "name": "Motion Detected?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1430,
    "y": 480,
    "wires": [
      [
        "159b982b.7daba8"
      ]
    ]
  },
  {
    "id": "b36b537e.1da76",
    "type": "switch",
    "z": "e1915b16.64af68",
    "name": "on",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 610,
    "y": 480,
    "wires": [
      [
        "be3ab47f.7161e8"
      ]
    ]
  },
  {
    "id": "159b982b.7daba8",
    "type": "switch",
    "z": "e1915b16.64af68",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1610,
    "y": 480,
    "wires": [
      [
        "7b3902f1.40bb3c"
      ],
      [
        "1a1b22e.fd340dd"
      ]
    ],
    "outputLabels": [
      "On",
      "Off"
    ]
  },
  {
    "id": "2c54b49.68e174c",
    "type": "state-machine",
    "z": "e1915b16.64af68",
    "name": "State Machine",
    "triggerProperty": "payload",
    "triggerPropertyType": "msg",
    "stateProperty": "payload",
    "statePropertyType": "msg",
    "outputStateChangeOnly": true,
    "throwException": false,
    "states": [
      "default",
      "switch",
      "motion-detected",
      "motion-on",
      "motion-off",
      "off",
      "on"
    ],
    "transitions": [
      {
        "name": "motion",
        "from": "off",
        "to": "motion-detected"
      },
      {
        "name": "motion",
        "from": "motion-on",
        "to": "motion-on"
      },
      {
        "name": "off",
        "from": "*",
        "to": "off"
      },
      {
        "name": "on",
        "from": "*",
        "to": "on"
      },
      {
        "name": "switch",
        "from": "off",
        "to": "switch"
      },
      {
        "name": "switch",
        "from": "on",
        "to": "switch"
      },
      {
        "name": "switch",
        "from": "switch",
        "to": "switch"
      },
      {
        "name": "switch",
        "from": "motion-on",
        "to": "switch"
      },
      {
        "name": "motion-on",
        "from": "motion-detected",
        "to": "motion-on"
      },
      {
        "name": "motion-off",
        "from": "motion-on",
        "to": "motion-off"
      },
      {
        "name": "motion-off",
        "from": "on",
        "to": "motion-off"
      },
      {
        "name": "motion-detected",
        "from": "default",
        "to": "motion-detected"
      }
    ],
    "x": 400,
    "y": 180,
    "wires": [
      [
        "b36b537e.1da76",
        "80b953e7.e2b39",
        "45931f9a.f21ad",
        "20a993cb.e6d0cc",
        "54245662.e9ace8",
        "7c6c5e12.46d77"
      ]
    ]
  },
  {
    "id": "1a1b22e.fd340dd",
    "type": "change",
    "z": "e1915b16.64af68",
    "name": "motion-off",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion-off",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1950,
    "y": 300,
    "wires": [
      [
        "90ec9175.4c41"
      ]
    ]
  },
  {
    "id": "7b3902f1.40bb3c",
    "type": "function",
    "z": "e1915b16.64af68",
    "name": "Configure Light State",
    "func": "return { \n    payload: {\n        entity_id: flow.get(\"light_entity_id\")\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1720,
    "y": 240,
    "wires": [
      [
        "c8ccf58f.276048"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "831dee6.4a74f1",
    "type": "link in",
    "z": "e1915b16.64af68",
    "name": "Motion State Machine",
    "links": [
      "90ec9175.4c41"
    ],
    "x": 335,
    "y": 100,
    "wires": [
      [
        "2c54b49.68e174c"
      ]
    ]
  },
  {
    "id": "80b953e7.e2b39",
    "type": "switch",
    "z": "e1915b16.64af68",
    "name": "motion-detected",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "motion-detected",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 650,
    "y": 180,
    "wires": [
      [
        "9d9299c0.9275c8"
      ]
    ]
  },
  {
    "id": "45931f9a.f21ad",
    "type": "switch",
    "z": "e1915b16.64af68",
    "name": "motion-on",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "motion-on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 630,
    "y": 300,
    "wires": [
      [
        "252c81c7.37524e"
      ]
    ]
  },
  {
    "id": "20a993cb.e6d0cc",
    "type": "switch",
    "z": "e1915b16.64af68",
    "name": "switch",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "switch",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 610,
    "y": 360,
    "wires": [
      [
        "a4eab2c2.022b",
        "8f032cdb.2097b"
      ]
    ]
  },
  {
    "id": "54245662.e9ace8",
    "type": "switch",
    "z": "e1915b16.64af68",
    "name": "motion-off",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "motion-off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 630,
    "y": 240,
    "wires": [
      [
        "3ea54a10.7c55e6"
      ]
    ]
  },
  {
    "id": "7c6c5e12.46d77",
    "type": "switch",
    "z": "e1915b16.64af68",
    "name": "default",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "default",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 610,
    "y": 540,
    "wires": [
      [
        "e9ca4e8.8983bb"
      ]
    ]
  },
  {
    "id": "56ee4cfd.f5b314",
    "type": "function",
    "z": "e1915b16.64af68",
    "name": "Set Flow State",
    "func": "if (!msg.payload) {\n    return \"default\";\n}\n\nconst sensor_entity_id = msg.payload.sensor_entity_id;\nconst light_entity_id = msg.payload.light_entity_id;\nconst speech_entity_id = msg.payload.speech_entity_id || \"media_player.office_echo_plus\";\n\nflow.set(\"sensor_entity_id\", sensor_entity_id);\nflow.set(\"light_entity_id\", light_entity_id);\nflow.set(\"speech_entity_id\", speech_entity_id);\n\nnode.log(\"Incoming state: \" + msg.payload.state);\nnode.status({ fill: \"green\", shape: \"dot\", text: msg.payload.state });\nreturn { payload: msg.payload.state || \"default\" };",
    "outputs": 1,
    "noerr": 0,
    "x": 200,
    "y": 180,
    "wires": [
      [
        "2c54b49.68e174c"
      ]
    ]
  },
  {
    "id": "90ec9175.4c41",
    "type": "link out",
    "z": "e1915b16.64af68",
    "name": "Motion State Machine",
    "links": [
      "831dee6.4a74f1"
    ],
    "x": 2135,
    "y": 120,
    "wires": []
  },
  {
    "id": "252c81c7.37524e",
    "type": "stoptimer",
    "z": "e1915b16.64af68",
    "duration": "5",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "5 Minute Delay",
    "x": 1080,
    "y": 300,
    "wires": [
      [
        "1a1b22e.fd340dd"
      ],
      []
    ]
  },
  {
    "id": "2a98653f.85c65a",
    "type": "stoptimer",
    "z": "e1915b16.64af68",
    "duration": "10",
    "units": "Second",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "10 Second Delay",
    "x": 1410,
    "y": 240,
    "wires": [
      [
        "7b3902f1.40bb3c"
      ],
      []
    ]
  },
  {
    "id": "c8ccf58f.276048",
    "type": "api-current-state",
    "z": "e1915b16.64af68",
    "name": "Light State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1950,
    "y": 240,
    "wires": [
      [
        "90ec9175.4c41"
      ]
    ]
  },
  {
    "id": "8f032cdb.2097b",
    "type": "stoptimer",
    "z": "e1915b16.64af68",
    "duration": "5",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "Pause Detection for 5 minutes",
    "x": 910,
    "y": 420,
    "wires": [
      [
        "7b3902f1.40bb3c"
      ],
      []
    ]
  },
  {
    "id": "242160c8.b9134",
    "type": "switch",
    "z": "e1915b16.64af68",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1610,
    "y": 540,
    "wires": [
      [
        "15d6111a.ed343f"
      ],
      [
        "7b3902f1.40bb3c"
      ]
    ],
    "outputLabels": [
      "On",
      "Off"
    ]
  },
  {
    "id": "59abc3e5.ba08fc",
    "type": "inject",
    "z": "e1915b16.64af68",
    "name": "steady-state",
    "topic": "",
    "payload": "stop",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 1190,
    "y": 420,
    "wires": [
      [
        "7b3902f1.40bb3c",
        "8f032cdb.2097b"
      ]
    ]
  },
  {
    "id": "9d9299c0.9275c8",
    "type": "function",
    "z": "e1915b16.64af68",
    "name": "Configure Light",
    "func": "return { \n    payload: {\n        speech_entity_id: flow.get(\"speech_entity_id\"),\n        entity_id: flow.get(\"light_entity_id\"),\n        state: \"on\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 860,
    "y": 180,
    "wires": [
      [
        "9d33fe0f.78b9c"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "a4eab2c2.022b",
    "type": "change",
    "z": "e1915b16.64af68",
    "name": "stop",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "stop",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 830,
    "y": 360,
    "wires": [
      [
        "252c81c7.37524e"
      ]
    ]
  },
  {
    "id": "3ea54a10.7c55e6",
    "type": "function",
    "z": "e1915b16.64af68",
    "name": "Configure Light",
    "func": "return { \n    payload: {\n        speech_entity_id: flow.get(\"speech_entity_id\"),\n        entity_id: flow.get(\"light_entity_id\"),\n        state: \"off\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 860,
    "y": 240,
    "wires": [
      [
        "4ad2d21b.96798c"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "a6729278.d3dca",
    "type": "change",
    "z": "e1915b16.64af68",
    "name": "motion-on",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion-on",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1950,
    "y": 180,
    "wires": [
      [
        "90ec9175.4c41"
      ]
    ]
  },
  {
    "id": "15d6111a.ed343f",
    "type": "change",
    "z": "e1915b16.64af68",
    "name": "motion-detected",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion-detected",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1970,
    "y": 360,
    "wires": [
      [
        "90ec9175.4c41"
      ]
    ]
  },
  {
    "id": "af590745.e61448",
    "type": "stoptimer",
    "z": "e1915b16.64af68",
    "duration": "10",
    "units": "Second",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "10 Second Delay",
    "x": 1390,
    "y": 180,
    "wires": [
      [
        "a6729278.d3dca"
      ],
      []
    ]
  },
  {
    "id": "e9ca4e8.8983bb",
    "type": "function",
    "z": "e1915b16.64af68",
    "name": "Configure Sensor State",
    "func": "return { \n    payload: {\n        entity_id: flow.get(\"sensor_entity_id\")\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 890,
    "y": 540,
    "wires": [
      [
        "69dc9190.c8e91"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "69dc9190.c8e91",
    "type": "api-current-state",
    "z": "e1915b16.64af68",
    "name": "Motion Detected?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1130,
    "y": 540,
    "wires": [
      [
        "242160c8.b9134"
      ]
    ]
  },
  {
    "id": "d12d156d.08fa28",
    "type": "comment",
    "z": "e1915b16.64af68",
    "name": "Check to see if state requires light detection.",
    "info": "If requires light detection, turn on or off based on light level.",
    "x": 210,
    "y": 40,
    "wires": []
  },
  {
    "id": "9d33fe0f.78b9c",
    "type": "subflow:bafd53de.69711",
    "z": "e1915b16.64af68",
    "name": "",
    "x": 1120,
    "y": 180,
    "wires": [
      [
        "af590745.e61448"
      ]
    ]
  },
  {
    "id": "4ad2d21b.96798c",
    "type": "subflow:bafd53de.69711",
    "z": "e1915b16.64af68",
    "name": "",
    "x": 1120,
    "y": 240,
    "wires": [
      [
        "2a98653f.85c65a"
      ]
    ]
  },
  {
    "id": "356e25a2.ddaa2a",
    "type": "subflow:e1915b16.64af68",
    "z": "19c1cd7b.5d8c23",
    "name": "",
    "env": [],
    "x": 1450,
    "y": 1580,
    "wires": []
  },
  {
    "id": "c0ae90d4.5e0e58",
    "type": "change",
    "z": "7dca484b.45ae",
    "name": "switch",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "switch",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "binary_sensor.kitchen_sink_lights_motion_switch_motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 650,
    "y": 1320,
    "wires": [
      [
        "a4b79e97.91733"
      ]
    ]
  },
  {
    "id": "a490698c.abce88",
    "type": "change",
    "z": "7dca484b.45ae",
    "name": "motion",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 650,
    "y": 1240,
    "wires": [
      [
        "a4b79e97.91733"
      ]
    ]
  },
  {
    "id": "11229104.74bf17",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "Trigger Motion",
    "topic": "binary_sensor.kitchen_sink_lights_motion_switch_motion",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 470,
    "y": 1220,
    "wires": [
      [
        "a490698c.abce88"
      ]
    ]
  },
  {
    "id": "a4b79e97.91733",
    "type": "function",
    "z": "7dca484b.45ae",
    "name": "Set State",
    "func": "return { \n    payload: {\n        sensor_entity_id: msg.topic,\n        light_entity_id: \"light.kitchen_sink_lights_motion_dimmer_level\",\n        speech_entity_id: \"media_player.kitchen_echo_plus\",\n        state: msg.payload || \"default\"\n    }\n}",
    "outputs": 1,
    "noerr": 0,
    "x": 800,
    "y": 1280,
    "wires": [
      [
        "a9c688ad.1d4a38"
      ]
    ]
  },
  {
    "id": "36e9c5e0.dc54a2",
    "type": "function",
    "z": "7dca484b.45ae",
    "name": "Configure Sensor State",
    "func": "return { \n    payload: {\n        entity_id: flow.get(\"sensor_entity_id\")\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1110,
    "y": 1760,
    "wires": [
      [
        "ebc41f58.a4e73"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "13397869.ab9338",
    "type": "stoptimer",
    "z": "7dca484b.45ae",
    "duration": "15",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "Pause Detection for 15 minutes",
    "x": 830,
    "y": 1760,
    "wires": [
      [
        "36e9c5e0.dc54a2"
      ],
      []
    ]
  },
  {
    "id": "ebc41f58.a4e73",
    "type": "api-current-state",
    "z": "7dca484b.45ae",
    "name": "Motion Detected?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1350,
    "y": 1760,
    "wires": [
      [
        "99010537.8987d8"
      ]
    ]
  },
  {
    "id": "96866577.fe245",
    "type": "switch",
    "z": "7dca484b.45ae",
    "name": "on",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 530,
    "y": 1760,
    "wires": [
      [
        "13397869.ab9338"
      ]
    ]
  },
  {
    "id": "99010537.8987d8",
    "type": "switch",
    "z": "7dca484b.45ae",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1530,
    "y": 1760,
    "wires": [
      [
        "e23e5bba.0ad93"
      ],
      [
        "4ad9c123.5056e"
      ]
    ],
    "outputLabels": [
      "On",
      "Off"
    ]
  },
  {
    "id": "bd4367c9.793028",
    "type": "state-machine",
    "z": "7dca484b.45ae",
    "name": "State Machine",
    "triggerProperty": "payload",
    "triggerPropertyType": "msg",
    "stateProperty": "payload",
    "statePropertyType": "msg",
    "outputStateChangeOnly": true,
    "throwException": true,
    "states": [
      "default",
      "switch",
      "motion-detected",
      "motion-on",
      "motion-off",
      "off",
      "on"
    ],
    "transitions": [
      {
        "name": "motion",
        "from": "off",
        "to": "motion-detected"
      },
      {
        "name": "motion",
        "from": "motion-on",
        "to": "motion-on"
      },
      {
        "name": "off",
        "from": "*",
        "to": "off"
      },
      {
        "name": "on",
        "from": "*",
        "to": "on"
      },
      {
        "name": "switch",
        "from": "off",
        "to": "switch"
      },
      {
        "name": "switch",
        "from": "on",
        "to": "switch"
      },
      {
        "name": "switch",
        "from": "switch",
        "to": "switch"
      },
      {
        "name": "switch",
        "from": "motion-on",
        "to": "switch"
      },
      {
        "name": "motion-on",
        "from": "motion-detected",
        "to": "motion-on"
      },
      {
        "name": "motion-off",
        "from": "motion-on",
        "to": "motion-off"
      },
      {
        "name": "motion-off",
        "from": "on",
        "to": "motion-off"
      },
      {
        "name": "motion-detected",
        "from": "default",
        "to": "motion-detected"
      },
      {
        "name": "motion",
        "from": "default",
        "to": "motion-detected"
      }
    ],
    "x": 320,
    "y": 1460,
    "wires": [
      [
        "96866577.fe245",
        "e8ccb632.5e3178",
        "ef9276f5.cc67d",
        "92223843.da1e58",
        "7b2f4cc9.f196fc",
        "99055254.0f407",
        "da05700.04eb11"
      ]
    ]
  },
  {
    "id": "4ad9c123.5056e",
    "type": "change",
    "z": "7dca484b.45ae",
    "name": "motion-off",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion-off",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1870,
    "y": 1580,
    "wires": [
      [
        "47f9869a.ab8128"
      ]
    ]
  },
  {
    "id": "e23e5bba.0ad93",
    "type": "function",
    "z": "7dca484b.45ae",
    "name": "Configure Light State",
    "func": "return { \n    payload: {\n        entity_id: flow.get(\"light_entity_id\")\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 1640,
    "y": 1520,
    "wires": [
      [
        "7e216811.1b99a8",
        "2798b61.7c086ca"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "e8ccb632.5e3178",
    "type": "switch",
    "z": "7dca484b.45ae",
    "name": "motion-detected",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "motion-detected",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 570,
    "y": 1460,
    "wires": [
      [
        "5739d314.348ab4"
      ]
    ]
  },
  {
    "id": "ef9276f5.cc67d",
    "type": "switch",
    "z": "7dca484b.45ae",
    "name": "motion-on",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "motion-on",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 550,
    "y": 1580,
    "wires": [
      [
        "63584bef.7d86c4"
      ]
    ]
  },
  {
    "id": "92223843.da1e58",
    "type": "switch",
    "z": "7dca484b.45ae",
    "name": "switch",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "switch",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 530,
    "y": 1640,
    "wires": [
      [
        "c3ebc6df.b51b18",
        "9f140aff.cfe22"
      ]
    ]
  },
  {
    "id": "7b2f4cc9.f196fc",
    "type": "switch",
    "z": "7dca484b.45ae",
    "name": "motion-off",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "motion-off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 550,
    "y": 1520,
    "wires": [
      [
        "718faef7.7cf8f8"
      ]
    ]
  },
  {
    "id": "99055254.0f407",
    "type": "switch",
    "z": "7dca484b.45ae",
    "name": "default",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "default",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 1,
    "x": 530,
    "y": 1820,
    "wires": [
      [
        "89ad4e44.83d67",
        "20698dc8.854bba"
      ]
    ]
  },
  {
    "id": "a9c688ad.1d4a38",
    "type": "function",
    "z": "7dca484b.45ae",
    "name": "Set Flow State",
    "func": "if (!msg.payload) {\n    return \"default\";\n}\n\nconst sensor_entity_id = msg.payload.sensor_entity_id;\nconst light_entity_id = msg.payload.light_entity_id;\nconst speech_entity_id = msg.payload.speech_entity_id || \"media_player.office_echo_plus\";\n\nflow.set(\"sensor_entity_id\", sensor_entity_id);\nflow.set(\"light_entity_id\", light_entity_id);\nflow.set(\"speech_entity_id\", speech_entity_id);\n\nreturn { payload: msg.payload.state || \"default\" };",
    "outputs": 1,
    "noerr": 0,
    "x": 120,
    "y": 1460,
    "wires": [
      [
        "bd4367c9.793028",
        "10ccc99b.829ca6"
      ]
    ]
  },
  {
    "id": "63584bef.7d86c4",
    "type": "stoptimer",
    "z": "7dca484b.45ae",
    "duration": "5",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "5 Minute Delay",
    "x": 1000,
    "y": 1580,
    "wires": [
      [
        "4ad9c123.5056e"
      ],
      []
    ]
  },
  {
    "id": "db2d964a.363c88",
    "type": "stoptimer",
    "z": "7dca484b.45ae",
    "duration": "10",
    "units": "Second",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "10 Second Delay",
    "x": 1330,
    "y": 1520,
    "wires": [
      [
        "e23e5bba.0ad93"
      ],
      []
    ]
  },
  {
    "id": "7e216811.1b99a8",
    "type": "api-current-state",
    "z": "7dca484b.45ae",
    "name": "Light State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1870,
    "y": 1520,
    "wires": [
      [
        "57ba58b5.dcd59",
        "47f9869a.ab8128"
      ]
    ]
  },
  {
    "id": "9f140aff.cfe22",
    "type": "stoptimer",
    "z": "7dca484b.45ae",
    "duration": "5",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "Pause Detection for 5 minutes",
    "x": 830,
    "y": 1700,
    "wires": [
      [
        "e23e5bba.0ad93"
      ],
      []
    ]
  },
  {
    "id": "f74a10cd.bdbe48",
    "type": "switch",
    "z": "7dca484b.45ae",
    "name": "",
    "property": "payload",
    "propertyType": "msg",
    "rules": [
      {
        "t": "eq",
        "v": "on",
        "vt": "str"
      },
      {
        "t": "eq",
        "v": "off",
        "vt": "str"
      }
    ],
    "checkall": "true",
    "repair": false,
    "outputs": 2,
    "x": 1530,
    "y": 1820,
    "wires": [
      [
        "d86e6c52.5afda8"
      ],
      [
        "e23e5bba.0ad93"
      ]
    ],
    "outputLabels": [
      "On",
      "Off"
    ]
  },
  {
    "id": "f4b5da46.40e63",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "steady-state",
    "topic": "",
    "payload": "stop",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 1110,
    "y": 1700,
    "wires": [
      [
        "e23e5bba.0ad93",
        "9f140aff.cfe22"
      ]
    ]
  },
  {
    "id": "5739d314.348ab4",
    "type": "function",
    "z": "7dca484b.45ae",
    "name": "Configure Light",
    "func": "return { \n    payload: {\n        speech_entity_id: flow.get(\"speech_entity_id\"),\n        entity_id: flow.get(\"light_entity_id\"),\n        state: \"on\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 780,
    "y": 1460,
    "wires": [
      [
        "8971c298.9ecac8"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "c3ebc6df.b51b18",
    "type": "change",
    "z": "7dca484b.45ae",
    "name": "stop",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "stop",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 750,
    "y": 1640,
    "wires": [
      [
        "63584bef.7d86c4"
      ]
    ]
  },
  {
    "id": "718faef7.7cf8f8",
    "type": "function",
    "z": "7dca484b.45ae",
    "name": "Configure Light",
    "func": "return { \n    payload: {\n        speech_entity_id: flow.get(\"speech_entity_id\"),\n        entity_id: flow.get(\"light_entity_id\"),\n        state: \"off\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 780,
    "y": 1520,
    "wires": [
      [
        "70a2b552.3e07b4"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "d20152bc.dde448",
    "type": "change",
    "z": "7dca484b.45ae",
    "name": "motion-on",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion-on",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1870,
    "y": 1460,
    "wires": [
      [
        "47f9869a.ab8128"
      ]
    ]
  },
  {
    "id": "d86e6c52.5afda8",
    "type": "change",
    "z": "7dca484b.45ae",
    "name": "motion-detected",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion-detected",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1890,
    "y": 1640,
    "wires": [
      [
        "47f9869a.ab8128"
      ]
    ]
  },
  {
    "id": "50ea6af3.bc38fc",
    "type": "stoptimer",
    "z": "7dca484b.45ae",
    "duration": "10",
    "units": "Second",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "10 Second Delay",
    "x": 1310,
    "y": 1460,
    "wires": [
      [
        "d20152bc.dde448"
      ],
      []
    ]
  },
  {
    "id": "89ad4e44.83d67",
    "type": "function",
    "z": "7dca484b.45ae",
    "name": "Configure Sensor State",
    "func": "return { \n    payload: {\n        entity_id: flow.get(\"sensor_entity_id\")\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 810,
    "y": 1820,
    "wires": [
      [
        "f299f234.965718"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "f299f234.965718",
    "type": "api-current-state",
    "z": "7dca484b.45ae",
    "name": "Motion Detected?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 1050,
    "y": 1820,
    "wires": [
      [
        "f74a10cd.bdbe48",
        "18902b62.5aab65"
      ]
    ]
  },
  {
    "id": "8971c298.9ecac8",
    "type": "subflow:bafd53de.69711",
    "z": "7dca484b.45ae",
    "name": "",
    "x": 1040,
    "y": 1460,
    "wires": [
      [
        "50ea6af3.bc38fc"
      ]
    ]
  },
  {
    "id": "70a2b552.3e07b4",
    "type": "subflow:bafd53de.69711",
    "z": "7dca484b.45ae",
    "name": "",
    "x": 1040,
    "y": 1520,
    "wires": [
      [
        "db2d964a.363c88"
      ]
    ]
  },
  {
    "id": "10ccc99b.829ca6",
    "type": "debug",
    "z": "7dca484b.45ae",
    "name": "Flow State",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 290,
    "y": 1620,
    "wires": []
  },
  {
    "id": "da05700.04eb11",
    "type": "debug",
    "z": "7dca484b.45ae",
    "name": "State Machine",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 320,
    "y": 1540,
    "wires": []
  },
  {
    "id": "20698dc8.854bba",
    "type": "debug",
    "z": "7dca484b.45ae",
    "name": "Default State",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 670,
    "y": 1880,
    "wires": []
  },
  {
    "id": "18902b62.5aab65",
    "type": "debug",
    "z": "7dca484b.45ae",
    "name": "Motion Detected?",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 1270,
    "y": 1900,
    "wires": []
  },
  {
    "id": "2798b61.7c086ca",
    "type": "debug",
    "z": "7dca484b.45ae",
    "name": "Configure Light State",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 1840,
    "y": 1740,
    "wires": []
  },
  {
    "id": "57ba58b5.dcd59",
    "type": "debug",
    "z": "7dca484b.45ae",
    "name": "Light State",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 1810,
    "y": 1800,
    "wires": []
  },
  {
    "id": "7228aeb5.92e058",
    "type": "link in",
    "z": "7dca484b.45ae",
    "name": "",
    "links": [
      "47f9869a.ab8128"
    ],
    "x": 315,
    "y": 1360,
    "wires": [
      [
        "bd4367c9.793028"
      ]
    ]
  },
  {
    "id": "47f9869a.ab8128",
    "type": "link out",
    "z": "7dca484b.45ae",
    "name": "",
    "links": [
      "7228aeb5.92e058"
    ],
    "x": 2075,
    "y": 1360,
    "wires": []
  },
  {
    "id": "977d608f.8b2188",
    "type": "inject",
    "z": "f67c7a34.9bcde",
    "name": "",
    "topic": "",
    "payload": "on",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 90,
    "y": 380,
    "wires": [
      [
        "d08cb212.53989"
      ]
    ]
  },
  {
    "id": "3d8e1cde.9aaa74",
    "type": "inject",
    "z": "f67c7a34.9bcde",
    "name": "",
    "topic": "",
    "payload": "off",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 90,
    "y": 420,
    "wires": [
      [
        "d08cb212.53989"
      ]
    ]
  },
  {
    "id": "d08cb212.53989",
    "type": "bigtimer",
    "z": "f67c7a34.9bcde",
    "outtopic": "",
    "outpayload1": "on",
    "outpayload2": "off",
    "name": "Christmas Lights",
    "comment": "Turn on 15 minutes before dusk and turn off at 11pm",
    "lat": "44.62617737045897",
    "lon": "-88.03619097769018",
    "starttime": "5004",
    "endtime": "1320",
    "startoff": "0",
    "endoff": 0,
    "offs": 0,
    "outtext1": "",
    "outtext2": "",
    "timeout": "240",
    "sun": true,
    "mon": true,
    "tue": true,
    "wed": true,
    "thu": true,
    "fri": true,
    "sat": true,
    "jan": true,
    "feb": false,
    "mar": false,
    "apr": false,
    "may": false,
    "jun": false,
    "jul": false,
    "aug": false,
    "sep": false,
    "oct": false,
    "nov": false,
    "dec": true,
    "day1": 0,
    "month1": 0,
    "day2": 0,
    "month2": 0,
    "day3": 0,
    "month3": 0,
    "day4": 0,
    "month4": 0,
    "day5": 0,
    "month5": 0,
    "day6": 0,
    "month6": 0,
    "d1": 0,
    "w1": 0,
    "d2": 0,
    "w2": 0,
    "d3": 0,
    "w3": 0,
    "d4": 0,
    "w4": 0,
    "d5": 0,
    "w5": 0,
    "d6": 0,
    "w6": 0,
    "xday1": "",
    "xmonth1": "",
    "xday2": "",
    "xmonth2": "",
    "xday3": "",
    "xmonth3": "",
    "xday4": "",
    "xmonth4": "",
    "xday5": "",
    "xmonth5": "",
    "xday6": "",
    "xmonth6": "",
    "xd1": 0,
    "xw1": 0,
    "xd2": 0,
    "xw2": 0,
    "xd3": 0,
    "xw3": 0,
    "xd4": 0,
    "xw4": 0,
    "xd5": 0,
    "xw5": 0,
    "xd6": 0,
    "xw6": 0,
    "suspend": false,
    "random": false,
    "repeat": true,
    "atstart": true,
    "odd": false,
    "even": false,
    "x": 290,
    "y": 400,
    "wires": [
      [
        "de8b6ebc.282b9"
      ],
      [],
      []
    ]
  },
  {
    "id": "6da36a6b.d2dee4",
    "type": "inject",
    "z": "f67c7a34.9bcde",
    "name": "",
    "topic": "",
    "payload": "auto",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 90,
    "y": 460,
    "wires": [
      [
        "d08cb212.53989"
      ]
    ]
  },
  {
    "id": "de8b6ebc.282b9",
    "type": "api-current-state",
    "z": "f67c7a34.9bcde",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 520,
    "y": 400,
    "wires": [
      [
        "9dae43c2.7bfde"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "9dae43c2.7bfde",
    "type": "api-current-state",
    "z": "f67c7a34.9bcde",
    "name": "Christmas Lights Automation Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_christmas_lights",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 820,
    "y": 400,
    "wires": [
      [
        "1f6946e1.54ac59"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "5d4b1d3b.a5f654",
    "type": "inject",
    "z": "f67c7a34.9bcde",
    "name": "",
    "topic": "",
    "payload": "manual",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 90,
    "y": 500,
    "wires": [
      [
        "d08cb212.53989"
      ]
    ]
  },
  {
    "id": "f254f9e4.b9429",
    "type": "server-state-changed",
    "z": "f67c7a34.9bcde",
    "name": "Switch Turned On/Off?",
    "server": "61956bd4.93df44",
    "entityidfilter": "group.christmas_lights",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 1,
    "x": 140,
    "y": 560,
    "wires": [
      [
        "d08cb212.53989"
      ]
    ]
  },
  {
    "id": "1f6946e1.54ac59",
    "type": "rbe",
    "z": "f67c7a34.9bcde",
    "name": "Only allow changed values",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 440,
    "y": 500,
    "wires": [
      [
        "c3740311.f0a9f8"
      ]
    ]
  },
  {
    "id": "1f1698a7.d7607f",
    "type": "subflow:af0c5464.36789",
    "z": "f67c7a34.9bcde",
    "name": "",
    "x": 950,
    "y": 500,
    "wires": [
      []
    ]
  },
  {
    "id": "6eb56543.92e12c",
    "type": "comment",
    "z": "f67c7a34.9bcde",
    "name": "Turn on Christmas lights from sunset till 10pm",
    "info": "",
    "x": 190,
    "y": 340,
    "wires": []
  },
  {
    "id": "c3740311.f0a9f8",
    "type": "function",
    "z": "f67c7a34.9bcde",
    "name": "Configure Lights",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.kitchen_echo_plus\",\n        entity_id: \"group.christmas_lights\",\n        state: msg.payload\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 680,
    "y": 500,
    "wires": [
      [
        "1f1698a7.d7607f"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "bafb0e97.0f9728",
    "type": "server-state-changed",
    "z": "74ac8f9a.f9fa3",
    "name": "Master Bathroom Shower Lights",
    "server": "61956bd4.93df44",
    "entityidfilter": "light.master_bathroom_shower_lights",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": false,
    "x": 170,
    "y": 580,
    "wires": [
      [
        "4ccf13b3.a5cc0c"
      ],
      []
    ]
  },
  {
    "id": "4498a052.da1cb8",
    "type": "server-state-changed",
    "z": "74ac8f9a.f9fa3",
    "name": "Master Bathroom Tub Lights",
    "server": "61956bd4.93df44",
    "entityidfilter": "light.master_bathroom_tub_lights",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": false,
    "x": 160,
    "y": 640,
    "wires": [
      [
        "4ccf13b3.a5cc0c"
      ],
      []
    ]
  },
  {
    "id": "6e5019ef.93ef48",
    "type": "server-state-changed",
    "z": "74ac8f9a.f9fa3",
    "name": "Kids Bathroom Tub Lights",
    "server": "61956bd4.93df44",
    "entityidfilter": "light.kids_bathroom_tub_lights",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": false,
    "x": 150,
    "y": 320,
    "wires": [
      [
        "9da43389.42eb3"
      ],
      []
    ]
  },
  {
    "id": "b1e665b4.4b557",
    "type": "comment",
    "z": "74ac8f9a.f9fa3",
    "name": "Use a timer, disable timer if light is turned off within 1 minute.",
    "info": "",
    "x": 600,
    "y": 220,
    "wires": []
  },
  {
    "id": "4ccf13b3.a5cc0c",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 460,
    "y": 600,
    "wires": [
      [
        "d3f7e4f2.ded38"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "d3f7e4f2.ded38",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Bathroom Fans Automation Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_inside_bathroom_fans",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 730,
    "y": 600,
    "wires": [
      [
        "84bf3219.1c857"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "9da43389.42eb3",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 420,
    "y": 320,
    "wires": [
      [
        "5220a283.b51bec"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "5220a283.b51bec",
    "type": "api-current-state",
    "z": "74ac8f9a.f9fa3",
    "name": "Bathroom Fans Automation Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_inside_bathroom_fans",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 690,
    "y": 320,
    "wires": [
      [
        "41595ef1.c39598"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "6155ea7d.8caf14",
    "type": "inject",
    "z": "62d08d27.0c9114",
    "name": "",
    "topic": "",
    "payload": "on",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 90,
    "y": 80,
    "wires": [
      [
        "a7abd9af.6fee28"
      ]
    ]
  },
  {
    "id": "48f5e2fb.6a2874",
    "type": "inject",
    "z": "62d08d27.0c9114",
    "name": "",
    "topic": "",
    "payload": "off",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 90,
    "y": 120,
    "wires": [
      [
        "a7abd9af.6fee28"
      ]
    ]
  },
  {
    "id": "a7abd9af.6fee28",
    "type": "bigtimer",
    "z": "62d08d27.0c9114",
    "outtopic": "",
    "outpayload1": "on",
    "outpayload2": "off",
    "name": "Family Room Lights",
    "comment": "Turn on 15 minutes before dusk and turn off at 10pm",
    "lat": "44.62617737045897",
    "lon": "-88.03619097769018",
    "starttime": "5004",
    "endtime": "1320",
    "startoff": "0",
    "endoff": 0,
    "startoff2": "",
    "endoff2": "",
    "offs": 0,
    "outtext1": "",
    "outtext2": "",
    "timeout": "240",
    "sun": true,
    "mon": true,
    "tue": true,
    "wed": true,
    "thu": true,
    "fri": true,
    "sat": true,
    "jan": true,
    "feb": true,
    "mar": true,
    "apr": true,
    "may": true,
    "jun": true,
    "jul": true,
    "aug": true,
    "sep": true,
    "oct": true,
    "nov": true,
    "dec": true,
    "day1": 0,
    "month1": 0,
    "day2": 0,
    "month2": 0,
    "day3": 0,
    "month3": 0,
    "day4": 0,
    "month4": 0,
    "day5": 0,
    "month5": 0,
    "day6": 0,
    "month6": 0,
    "d1": 0,
    "w1": 0,
    "d2": 0,
    "w2": 0,
    "d3": 0,
    "w3": 0,
    "d4": 0,
    "w4": 0,
    "d5": 0,
    "w5": 0,
    "d6": 0,
    "w6": 0,
    "xday1": "",
    "xmonth1": "",
    "xday2": "",
    "xmonth2": "",
    "xday3": "",
    "xmonth3": "",
    "xday4": "",
    "xmonth4": "",
    "xday5": "",
    "xmonth5": "",
    "xday6": "",
    "xmonth6": "",
    "xd1": 0,
    "xw1": 0,
    "xd2": 0,
    "xw2": 0,
    "xd3": 0,
    "xw3": 0,
    "xd4": 0,
    "xw4": 0,
    "xd5": 0,
    "xw5": 0,
    "xd6": 0,
    "xw6": 0,
    "suspend": false,
    "random": false,
    "repeat": true,
    "atstart": true,
    "odd": false,
    "even": false,
    "x": 300,
    "y": 100,
    "wires": [
      [
        "4d4ec75a.a0a34"
      ],
      [],
      []
    ]
  },
  {
    "id": "dd22a932.2b27f8",
    "type": "inject",
    "z": "62d08d27.0c9114",
    "name": "",
    "topic": "",
    "payload": "auto",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 90,
    "y": 160,
    "wires": [
      [
        "a7abd9af.6fee28"
      ]
    ]
  },
  {
    "id": "4d4ec75a.a0a34",
    "type": "api-current-state",
    "z": "62d08d27.0c9114",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 540,
    "y": 100,
    "wires": [
      [
        "639a61c8.967e88"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "639a61c8.967e88",
    "type": "api-current-state",
    "z": "62d08d27.0c9114",
    "name": "Family Room Lights Automation Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lamp_lights",
    "state_type": "str",
    "state_location": "",
    "override_payload": "none",
    "entity_location": "",
    "override_data": "none",
    "x": 840,
    "y": 100,
    "wires": [
      [
        "a3d2fba8.ec212"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "fdb78c2d.0e3d48",
    "type": "inject",
    "z": "62d08d27.0c9114",
    "name": "",
    "topic": "",
    "payload": "manual",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 90,
    "y": 200,
    "wires": [
      [
        "a7abd9af.6fee28"
      ]
    ]
  },
  {
    "id": "a80a8946.d1e628",
    "type": "server-state-changed",
    "z": "62d08d27.0c9114",
    "name": "Switch Turned On/Off?",
    "server": "61956bd4.93df44",
    "entityidfilter": "light.family_room_lamp",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 1,
    "output_only_on_state_change": false,
    "x": 140,
    "y": 260,
    "wires": [
      [
        "a7abd9af.6fee28"
      ]
    ]
  },
  {
    "id": "a3d2fba8.ec212",
    "type": "rbe",
    "z": "62d08d27.0c9114",
    "name": "Only allow changed values",
    "func": "rbe",
    "gap": "",
    "start": "",
    "inout": "out",
    "property": "payload",
    "x": 440,
    "y": 200,
    "wires": [
      [
        "46eb15.9c3184ec"
      ]
    ]
  },
  {
    "id": "43143510.e0c65c",
    "type": "comment",
    "z": "62d08d27.0c9114",
    "name": "Turn on Family lights from sunset till 10pm",
    "info": "",
    "x": 180,
    "y": 40,
    "wires": []
  },
  {
    "id": "46eb15.9c3184ec",
    "type": "function",
    "z": "62d08d27.0c9114",
    "name": "Configure Lights",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.basement_window_echo\",\n        entity_id: \"light.family_room_lamp\",\n        state: msg.payload\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 680,
    "y": 200,
    "wires": [
      [
        "5be49071.531118"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "5be49071.531118",
    "type": "subflow:bafd53de.69711",
    "z": "62d08d27.0c9114",
    "name": "",
    "x": 940,
    "y": 200,
    "wires": [
      []
    ]
  },
  {
    "id": "54be94aa.6c0f04",
    "type": "status",
    "z": "74bc2936.720808",
    "name": "",
    "scope": null,
    "x": 740,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "33be2e20.a89fe2",
    "type": "status",
    "z": "e1915b16.64af68",
    "name": "",
    "scope": null,
    "x": 620,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "d8142bd2.f7a0f8",
    "type": "status",
    "z": "bafd53de.69711",
    "name": "",
    "scope": null,
    "x": 120,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "165f45da.76cc6a",
    "type": "status",
    "z": "6325f627.09e548",
    "name": "",
    "scope": null,
    "x": 120,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "3625a6c3.3ec702",
    "type": "status",
    "z": "af0c5464.36789",
    "name": "",
    "scope": null,
    "x": 140,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "ba88f8d5.b5d648",
    "type": "status",
    "z": "76be143e.dbb0e4",
    "name": "",
    "scope": null,
    "x": 140,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "7a662cd5.162a24",
    "type": "status",
    "z": "974adda.d2ea92",
    "name": "",
    "scope": null,
    "x": 120,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "aef53056.742438",
    "type": "status",
    "z": "7a62a2d3.c0f4a4",
    "name": "",
    "scope": null,
    "x": 100,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "7ebfb5cc.90789c",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 420,
    "y": 1000,
    "wires": [
      [
        "86d34058.b2d318"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "86d34058.b2d318",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Turn off Closet Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_inside_closet_lights",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 660,
    "y": 1000,
    "wires": [
      [
        "5bc043ef.83ecac"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "cf5e5b9d.e6c258",
    "type": "inject",
    "z": "cd444af.6970f38",
    "name": "",
    "topic": "",
    "payload": "stop",
    "payloadType": "str",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 130,
    "y": 1140,
    "wires": [
      [
        "1a533cf4.ae0cb3"
      ]
    ]
  },
  {
    "id": "ba6d9fe8.86b93",
    "type": "server-state-changed",
    "z": "cd444af.6970f38",
    "name": "Guest Bedroom Closet Lights",
    "server": "61956bd4.93df44",
    "entityidfilter": "switch.basement_bedroom_closet_main_lights",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": false,
    "x": 160,
    "y": 1000,
    "wires": [
      [
        "7ebfb5cc.90789c"
      ],
      []
    ]
  },
  {
    "id": "1a533cf4.ae0cb3",
    "type": "stoptimer",
    "z": "cd444af.6970f38",
    "duration": "15",
    "units": "Minute",
    "payloadtype": "num",
    "payloadval": "0",
    "name": "",
    "x": 320,
    "y": 1080,
    "wires": [
      [
        "94464557.663638"
      ],
      []
    ]
  },
  {
    "id": "5bc043ef.83ecac",
    "type": "api-current-state",
    "z": "cd444af.6970f38",
    "name": "Light Off?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "switch.basement_bedroom_closet_main_lights",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 120,
    "y": 1080,
    "wires": [
      [
        "1a533cf4.ae0cb3"
      ],
      []
    ]
  },
  {
    "id": "8a0d5c2c.daa7e8",
    "type": "subflow:af0c5464.36789",
    "z": "cd444af.6970f38",
    "name": "",
    "x": 810,
    "y": 1080,
    "wires": [
      []
    ]
  },
  {
    "id": "94464557.663638",
    "type": "function",
    "z": "cd444af.6970f38",
    "name": "Configure Light",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.basement_bedroom_ecobee_switch\",\n        entity_id: \"switch.basement_bedroom_closet_main_lights\",\n        state: \"off\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 540,
    "y": 1080,
    "wires": [
      [
        "8a0d5c2c.daa7e8"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "31b2f56a.8bc15a",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 440,
    "y": 340,
    "wires": [
      [
        "d315795e.4cd0e"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "d315795e.4cd0e",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 690,
    "y": 340,
    "wires": [
      [
        "ed8a6e69.9405b"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "23beffbe.e84818",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Family Room Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.family_room_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 160,
    "y": 340,
    "wires": [
      [
        "31b2f56a.8bc15a"
      ],
      []
    ]
  },
  {
    "id": "e2c5f9f9.3bc0c8",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1630,
    "y": 340,
    "wires": [
      []
    ]
  },
  {
    "id": "726f76dc.e3d858",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.basement_window_echo\",\n        message: (attributes && attributes.friendly_name || \"Motion\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1350,
    "y": 340,
    "wires": [
      [
        "e2c5f9f9.3bc0c8"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "49452e28.7a1368",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1130,
    "y": 340,
    "wires": [
      [
        "726f76dc.e3d858"
      ]
    ]
  },
  {
    "id": "ed8a6e69.9405b",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 920,
    "y": 340,
    "wires": [
      [
        "49452e28.7a1368"
      ]
    ]
  },
  {
    "id": "5ebfeac6.581d24",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 440,
    "y": 420,
    "wires": [
      [
        "a1ea6e6f.93da5"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "a1ea6e6f.93da5",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Accessibility Notifications",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.accessibility_notifications",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 690,
    "y": 420,
    "wires": [
      [
        "8b0d297b.87efe"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "8952cc7.6f10e3",
    "type": "trigger-state",
    "z": "edd021ae.2eeb9",
    "name": "Storage Room Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.storage_room_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 160,
    "y": 420,
    "wires": [
      [
        "5ebfeac6.581d24"
      ],
      []
    ]
  },
  {
    "id": "ad54ed76.1fd0c8",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "edd021ae.2eeb9",
    "name": "Send Automation Speech Notification",
    "x": 1630,
    "y": 420,
    "wires": [
      []
    ]
  },
  {
    "id": "284f90f9.60e578",
    "type": "function",
    "z": "edd021ae.2eeb9",
    "name": "Configure Message",
    "func": "const attributes = msg.data && msg.data.attributes\n\nreturn { \n    payload: {\n        entity_id: \"media_player.basement_window_echo\",\n        message: (attributes && attributes.friendly_name || \"Motion\") + \" Detected.\"\n    }\n};",
    "outputs": 1,
    "noerr": 0,
    "x": 1350,
    "y": 420,
    "wires": [
      [
        "ad54ed76.1fd0c8"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "3ea6cfc2.b718d8",
    "type": "api-current-state",
    "z": "edd021ae.2eeb9",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 1130,
    "y": 420,
    "wires": [
      [
        "284f90f9.60e578"
      ]
    ]
  },
  {
    "id": "8b0d297b.87efe",
    "type": "change",
    "z": "edd021ae.2eeb9",
    "name": "",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "data",
        "tot": "msg"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 920,
    "y": 420,
    "wires": [
      [
        "3ea6cfc2.b718d8"
      ]
    ]
  },
  {
    "id": "e2ea4a50.f9ae2",
    "type": "comment",
    "z": "19c1cd7b.5d8c23",
    "name": "Basement",
    "info": "",
    "x": 120,
    "y": 100,
    "wires": []
  },
  {
    "id": "45d625b2.d92de4",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "state_location": "",
    "override_payload": "none",
    "entity_location": "",
    "override_data": "none",
    "x": 400,
    "y": 240,
    "wires": [
      [
        "a5931d1.58b736"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "a5931d1.58b736",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 680,
    "y": 240,
    "wires": [
      [
        "ed39421f.366b18"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "31242b5.1c948d4",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Family Room Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.family_room_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 160,
    "y": 240,
    "wires": [
      [
        "45d625b2.d92de4"
      ],
      []
    ]
  },
  {
    "id": "d0a7e224.0a84e",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 600,
    "y": 320,
    "wires": [
      [
        "83c68303.e5c988"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "83c68303.e5c988",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 880,
    "y": 320,
    "wires": [
      [
        "d0a64c6b.826978"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "c458dd51.518868",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Family Room Motion Switch",
    "server": "61956bd4.93df44",
    "entityid": "switch.family_room_motion_switch",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 340,
    "y": 320,
    "wires": [
      [
        "d0a7e224.0a84e"
      ],
      []
    ]
  },
  {
    "id": "ed39421f.366b18",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Dark Outside?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "7500",
    "halt_if_type": "num",
    "halt_if_compare": "gte",
    "override_topic": false,
    "entity_id": "sensor.illuminance",
    "state_type": "num",
    "state_location": "",
    "override_payload": "none",
    "entity_location": "",
    "override_data": "none",
    "x": 940,
    "y": 240,
    "wires": [
      [
        "f42abd0b.19a508"
      ],
      []
    ]
  },
  {
    "id": "d0a64c6b.826978",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "switch",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "switch",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "binary_sensor.family_room_motion_switch_motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1110,
    "y": 320,
    "wires": [
      [
        "dbef39ac.0a575"
      ]
    ]
  },
  {
    "id": "f42abd0b.19a508",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "motion",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1110,
    "y": 240,
    "wires": [
      [
        "dbef39ac.0a575"
      ]
    ]
  },
  {
    "id": "15ef5aaf.bd574d",
    "type": "inject",
    "z": "19c1cd7b.5d8c23",
    "name": "Trigger Motion",
    "topic": "binary_sensor.family_room_motion_switch_motion",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 970,
    "y": 180,
    "wires": [
      [
        "f42abd0b.19a508"
      ]
    ]
  },
  {
    "id": "dbef39ac.0a575",
    "type": "function",
    "z": "19c1cd7b.5d8c23",
    "name": "Set State",
    "func": "return { \n    payload: {\n        sensor_entity_id: msg.topic,\n        switch_entity_id: \"switch.family_room_motion_switch\",\n        speech_entity_id: \"media_player.basement_ecobee4\",\n        state: msg.payload || \"default\"\n    }\n}",
    "outputs": 1,
    "noerr": 0,
    "x": 1260,
    "y": 280,
    "wires": [
      [
        "50b25f47.698b88"
      ]
    ]
  },
  {
    "id": "50b25f47.698b88",
    "type": "subflow:74bc2936.720808",
    "z": "19c1cd7b.5d8c23",
    "name": "",
    "env": [],
    "x": 1440,
    "y": 280,
    "wires": []
  },
  {
    "id": "84287e75.476ff",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 400,
    "y": 440,
    "wires": [
      [
        "57101396.62e8d4"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "57101396.62e8d4",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 680,
    "y": 440,
    "wires": [
      [
        "3c6a7d23.d14382"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "f181ade.0a538d",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Storage Room Motion",
    "server": "61956bd4.93df44",
    "entityid": "binary_sensor.storage_room_motion_switch_motion",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [
      {
        "id": "t8agwg8k43",
        "targetType": "this_entity",
        "targetValue": "",
        "propertyType": "current_state",
        "propertyValue": "new_state.state",
        "comparatorType": "is",
        "comparatorValueDatatype": "str",
        "comparatorValue": "on"
      }
    ],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 160,
    "y": 440,
    "wires": [
      [
        "84287e75.476ff"
      ],
      []
    ]
  },
  {
    "id": "d1b3e987.57c05",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 600,
    "y": 520,
    "wires": [
      [
        "53721fef.b8378"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      null
    ]
  },
  {
    "id": "53721fef.b8378",
    "type": "api-current-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Automatically Turn On/Off Lights?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "input_boolean.automation_inside_lights_on_motion",
    "state_type": "str",
    "override_payload": false,
    "override_data": false,
    "x": 880,
    "y": 520,
    "wires": [
      [
        "88199820.9e114"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "bf040b35.45e5d8",
    "type": "trigger-state",
    "z": "19c1cd7b.5d8c23",
    "name": "Storage Room Bathroom Switch",
    "server": "61956bd4.93df44",
    "entityid": "switch.storage_room_motion_switch",
    "entityidfiltertype": "exact",
    "debugenabled": false,
    "constraints": [],
    "constraintsmustmatch": "all",
    "outputs": 2,
    "customoutputs": [],
    "outputinitially": false,
    "state_type": "str",
    "x": 330,
    "y": 520,
    "wires": [
      [
        "d1b3e987.57c05"
      ],
      []
    ]
  },
  {
    "id": "88199820.9e114",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "switch",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "switch",
        "tot": "str"
      },
      {
        "t": "set",
        "p": "topic",
        "pt": "msg",
        "to": "binary_sensor.storage_room_motion_switch_motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1110,
    "y": 520,
    "wires": [
      [
        "2088469.f700bba"
      ]
    ]
  },
  {
    "id": "3c6a7d23.d14382",
    "type": "change",
    "z": "19c1cd7b.5d8c23",
    "name": "motion",
    "rules": [
      {
        "t": "set",
        "p": "payload",
        "pt": "msg",
        "to": "motion",
        "tot": "str"
      }
    ],
    "action": "",
    "property": "",
    "from": "",
    "to": "",
    "reg": false,
    "x": 1110,
    "y": 440,
    "wires": [
      [
        "2088469.f700bba"
      ]
    ]
  },
  {
    "id": "a5a898b3.a4116",
    "type": "inject",
    "z": "19c1cd7b.5d8c23",
    "name": "Trigger Motion",
    "topic": "binary_sensor.storage_room_motion_switch_motion",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 950,
    "y": 380,
    "wires": [
      [
        "3c6a7d23.d14382"
      ]
    ]
  },
  {
    "id": "2088469.f700bba",
    "type": "function",
    "z": "19c1cd7b.5d8c23",
    "name": "Set State",
    "func": "return { \n    payload: {\n        sensor_entity_id: msg.topic,\n        switch_entity_id: \"switch.storage_room_motion_switch\",\n        speech_entity_id: \"media_player.basement_ecobee4\",\n        state: msg.payload || \"default\"\n    }\n}",
    "outputs": 1,
    "noerr": 0,
    "x": 1260,
    "y": 480,
    "wires": [
      [
        "f51f69b7.79f59"
      ]
    ]
  },
  {
    "id": "f51f69b7.79f59",
    "type": "subflow:74bc2936.720808",
    "z": "19c1cd7b.5d8c23",
    "name": "",
    "env": [],
    "x": 1440,
    "y": 480,
    "wires": []
  },
  {
    "id": "b63a2a21.232ec",
    "type": "debug",
    "z": "74bc2936.720808",
    "name": "Link To State Machine",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 480,
    "y": 100,
    "wires": []
  },
  {
    "id": "feb6af5a.1d3ec8",
    "type": "debug",
    "z": "74bc2936.720808",
    "name": "State Machine Output",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 640,
    "y": 600,
    "wires": []
  },
  {
    "id": "f1f96e61.f07d7",
    "type": "debug",
    "z": "74bc2936.720808",
    "name": "Default - Motion Detected",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 1350,
    "y": 580,
    "wires": []
  },
  {
    "id": "d8ee35ae.b7ad88",
    "type": "api-current-state",
    "z": "7dca484b.45ae",
    "name": "",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "binary_sensor.family_room_motion_switch_motion",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 420,
    "y": 1120,
    "wires": [
      [
        "acff22.a1b2b0e"
      ]
    ]
  },
  {
    "id": "acff22.a1b2b0e",
    "type": "debug",
    "z": "7dca484b.45ae",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "x": 790,
    "y": 1120,
    "wires": []
  },
  {
    "id": "81da7897.0f4458",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 100,
    "y": 1120,
    "wires": [
      [
        "d8ee35ae.b7ad88"
      ]
    ]
  },
  {
    "id": "a6713c2c.82141",
    "type": "api-current-state",
    "z": "95c94ca0.1fe178",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 400,
    "y": 160,
    "wires": [
      [
        "f7f42751.a47a8"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "f7f42751.a47a8",
    "type": "api-current-state",
    "z": "95c94ca0.1fe178",
    "name": "Unlock Door on Garage Door Open",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_inside_unlock_doors_on_garage_door_open",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 680,
    "y": 160,
    "wires": [
      [
        "1288a5eb.39af5a"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "189564cc.5b1aab",
    "type": "server-state-changed",
    "z": "95c94ca0.1fe178",
    "name": "Left Garage Door Open",
    "server": "61956bd4.93df44",
    "entityidfilter": "cover.house_left_garage_door_opener",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "close,closing",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "x": 140,
    "y": 160,
    "wires": [
      [
        "a6713c2c.82141"
      ],
      []
    ]
  },
  {
    "id": "1288a5eb.39af5a",
    "type": "api-current-state",
    "z": "95c94ca0.1fe178",
    "name": "Back Foyer Locked?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "unlocked",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "lock.back_foyer_door_locked",
    "state_type": "str",
    "state_location": "",
    "override_payload": "none",
    "entity_location": "",
    "override_data": "none",
    "x": 160,
    "y": 240,
    "wires": [
      [
        "ed1102c.eaf3e8"
      ],
      []
    ]
  },
  {
    "id": "ed1102c.eaf3e8",
    "type": "function",
    "z": "95c94ca0.1fe178",
    "name": "Configure Lock",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.back_foyer_ecobee_switch\",\n        entity_id: \"lock.back_foyer_door_locked\",\n        state: \"unlocked\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 380,
    "y": 240,
    "wires": [
      [
        "27a6be29.734e2a"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "ac126103.783f3",
    "type": "comment",
    "z": "95c94ca0.1fe178",
    "name": "Automatically unlock door when garage door opens",
    "info": "",
    "x": 230,
    "y": 40,
    "wires": []
  },
  {
    "id": "eaa12799.48a2f",
    "type": "function",
    "z": "41fd29d8.74672",
    "name": "Set Lock Payload",
    "func": "const entity = msg.payload && msg.payload.entity_id;\nconst attributes = msg.data && msg.data.attributes\nif (!entity || !attributes) {\n    node.status({ fill: \"red\", shape: \"dot\", text: \"Invalid Lock payload\" });\n    return [null, null, null];\n}\n\nconst desired_state = msg.payload.state;\nif (!desired_state) {\n    let message = \"Invalid Lock State\";\n    node.status({ fill: \"red\", shape: \"dot\", text: message });\n    node.error(message);\n    return [null, null, { \n        payload: {\n            entity_id: entity,\n            message: message\n        }\n    }];\n}\n\nif (desired_state === msg.data.state) {\n    let message = \"Lock is already at the desired state.\";\n    node.status({ fill: \"grey\", shape: \"dot\", text: message });\n    node.log(message);\n    return [null, null, { \n        payload: {\n            entity_id: entity,\n            message: message\n        }\n    }];\n}\n\nconst shouldLock = desired_state === \"locked\";\nconst speechEntity = msg.payload.speech_entity_id;\nconst switchPayload = { \n    payload: {\n        data: {\n            entity_id: entity\n        } \n    }\n};\n\nlet message = (shouldLock ? \"Locking\" : \"Unlocking\") + \" \" + attributes.friendly_name;\nconst speechPayload = { \n    payload: {\n        entity_id: speechEntity,\n        message: message\n    }\n};\n\nnode.status({ fill: \"green\", shape: \"dot\", text: message });\nreturn [shouldLock ? switchPayload : null, !shouldLock ? switchPayload : null, speechPayload];",
    "outputs": 3,
    "noerr": 0,
    "x": 430,
    "y": 120,
    "wires": [
      [
        "648de272.3fb3ac"
      ],
      [
        "f069288c.f4d94"
      ],
      [
        "eea091e1.bf9168"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload",
      "Switch Off Payload",
      "Speech Notification Payload"
    ]
  },
  {
    "id": "eea091e1.bf9168",
    "type": "subflow:7a62a2d3.c0f4a4",
    "z": "41fd29d8.74672",
    "name": "",
    "x": 710,
    "y": 180,
    "wires": [
      []
    ]
  },
  {
    "id": "69eba8b5.83af88",
    "type": "api-current-state",
    "z": "41fd29d8.74672",
    "name": "Get Current State",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "",
    "state_type": "str",
    "state_location": "",
    "override_payload": "none",
    "entity_location": "data",
    "override_data": "msg",
    "x": 210,
    "y": 120,
    "wires": [
      [
        "eaa12799.48a2f"
      ]
    ]
  },
  {
    "id": "f069288c.f4d94",
    "type": "api-call-service",
    "z": "41fd29d8.74672",
    "name": "Unlock Door",
    "server": "61956bd4.93df44",
    "service_domain": "lock",
    "service": "unlock",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 630,
    "y": 120,
    "wires": [
      []
    ]
  },
  {
    "id": "648de272.3fb3ac",
    "type": "api-call-service",
    "z": "41fd29d8.74672",
    "name": "Lock Door",
    "server": "61956bd4.93df44",
    "service_domain": "lock",
    "service": "lock",
    "data": "",
    "mergecontext": "",
    "output_location": "payload",
    "output_location_type": "msg",
    "x": 630,
    "y": 60,
    "wires": [
      []
    ]
  },
  {
    "id": "3bd505bb.e7187a",
    "type": "status",
    "z": "41fd29d8.74672",
    "name": "",
    "scope": null,
    "x": 100,
    "y": 40,
    "wires": [
      []
    ]
  },
  {
    "id": "27a6be29.734e2a",
    "type": "subflow:41fd29d8.74672",
    "z": "95c94ca0.1fe178",
    "name": "",
    "env": [],
    "x": 640,
    "y": 240,
    "wires": [
      []
    ]
  },
  {
    "id": "380905ff.c7a23a",
    "type": "function",
    "z": "7dca484b.45ae",
    "name": "Configure Unlock",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.back_foyer_ecobee_switch\",\n        entity_id: \"lock.back_foyer_door_locked\",\n        state: \"unlocked\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 310,
    "y": 1980,
    "wires": [
      [
        "a0f9b37f.7be51"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "a0f9b37f.7be51",
    "type": "subflow:41fd29d8.74672",
    "z": "7dca484b.45ae",
    "name": "",
    "env": [],
    "x": 560,
    "y": 1980,
    "wires": [
      []
    ]
  },
  {
    "id": "7291c291.583874",
    "type": "api-current-state",
    "z": "7dca484b.45ae",
    "name": "cover.house_left_garage_door_opener",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "cover.house_left_garage_door_opener",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 350,
    "y": 2240,
    "wires": [
      [
        "3eb63e4.2b789c2"
      ]
    ]
  },
  {
    "id": "5d4d8c32.378314",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 100,
    "y": 2240,
    "wires": [
      [
        "7291c291.583874"
      ]
    ]
  },
  {
    "id": "3eb63e4.2b789c2",
    "type": "debug",
    "z": "7dca484b.45ae",
    "name": "",
    "active": true,
    "tosidebar": true,
    "console": false,
    "tostatus": false,
    "complete": "true",
    "targetType": "full",
    "x": 590,
    "y": 2240,
    "wires": []
  },
  {
    "id": "1a1ca19d.3bcde6",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 120,
    "y": 1980,
    "wires": [
      [
        "380905ff.c7a23a"
      ]
    ]
  },
  {
    "id": "6532f3c.8b1138c",
    "type": "function",
    "z": "7dca484b.45ae",
    "name": "Configure Locked",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.back_foyer_ecobee_switch\",\n        entity_id: \"lock.back_foyer_door_locked\",\n        state: \"locked\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 310,
    "y": 2040,
    "wires": [
      [
        "75f0ef5f.790f58"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "75f0ef5f.790f58",
    "type": "subflow:41fd29d8.74672",
    "z": "7dca484b.45ae",
    "name": "",
    "env": [],
    "x": 560,
    "y": 2040,
    "wires": [
      []
    ]
  },
  {
    "id": "d241073c.cbd538",
    "type": "inject",
    "z": "7dca484b.45ae",
    "name": "",
    "topic": "",
    "payload": "",
    "payloadType": "date",
    "repeat": "",
    "crontab": "",
    "once": false,
    "onceDelay": 0.1,
    "x": 120,
    "y": 2040,
    "wires": [
      [
        "6532f3c.8b1138c"
      ]
    ]
  },
  {
    "id": "aff681a2.4e1ae8",
    "type": "api-current-state",
    "z": "95c94ca0.1fe178",
    "name": "Automations Enabled?",
    "server": "61956bd4.93df44",
    "outputs": 1,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_enable",
    "state_type": "str",
    "override_payload": true,
    "override_data": true,
    "x": 400,
    "y": 320,
    "wires": [
      [
        "b3b59758.c1372"
      ]
    ],
    "outputLabels": [
      "enabled"
    ]
  },
  {
    "id": "b3b59758.c1372",
    "type": "api-current-state",
    "z": "95c94ca0.1fe178",
    "name": "Unlock Door on Garage Door Open",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "off",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": true,
    "entity_id": "input_boolean.automation_inside_unlock_doors_on_garage_door_open",
    "state_type": "str",
    "state_location": "payload",
    "override_payload": "msg",
    "entity_location": "data",
    "override_data": "msg",
    "x": 680,
    "y": 320,
    "wires": [
      [
        "39934bff.fbca04"
      ],
      []
    ],
    "outputLabels": [
      "enabled",
      ""
    ]
  },
  {
    "id": "39934bff.fbca04",
    "type": "api-current-state",
    "z": "95c94ca0.1fe178",
    "name": "Back Foyer Locked?",
    "server": "61956bd4.93df44",
    "outputs": 2,
    "halt_if": "unlocked",
    "halt_if_type": "str",
    "halt_if_compare": "is",
    "override_topic": false,
    "entity_id": "lock.back_foyer_door_locked",
    "state_type": "str",
    "state_location": "",
    "override_payload": "none",
    "entity_location": "",
    "override_data": "none",
    "x": 160,
    "y": 400,
    "wires": [
      [
        "ced4db81.e807d"
      ],
      []
    ]
  },
  {
    "id": "ced4db81.e807d",
    "type": "function",
    "z": "95c94ca0.1fe178",
    "name": "Configure Lock",
    "func": "return { \n    payload: {\n        speech_entity_id: \"media_player.back_foyer_ecobee_switch\",\n        entity_id: \"lock.back_foyer_door_locked\",\n        state: \"unlocked\"\n    }\n};\n",
    "outputs": 1,
    "noerr": 0,
    "x": 380,
    "y": 400,
    "wires": [
      [
        "95a44ce4.9617c"
      ]
    ],
    "inputLabels": [
      "Swtich State"
    ],
    "outputLabels": [
      "Switch On Payload"
    ]
  },
  {
    "id": "95a44ce4.9617c",
    "type": "subflow:41fd29d8.74672",
    "z": "95c94ca0.1fe178",
    "name": "",
    "env": [],
    "x": 640,
    "y": 400,
    "wires": [
      []
    ]
  },
  {
    "id": "7fc523b.82daadc",
    "type": "server-state-changed",
    "z": "95c94ca0.1fe178",
    "name": "Right Garage Door Open",
    "server": "61956bd4.93df44",
    "entityidfilter": "cover.house_right_garage_door_opener",
    "entityidfiltertype": "exact",
    "outputinitially": false,
    "state_type": "str",
    "haltifstate": "close,closing",
    "halt_if_type": "",
    "halt_if_compare": "is",
    "outputs": 2,
    "output_only_on_state_change": true,
    "x": 150,
    "y": 320,
    "wires": [
      [
        "aff681a2.4e1ae8"
      ],
      []
    ]
  }
]